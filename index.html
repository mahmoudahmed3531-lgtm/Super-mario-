<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>تحدّي الأسئلة - RPG</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0b1324;
    --panel:#111b34;
    --accent:#2dd4bf;
    --accent2:#22c55e;
    --danger:#ef4444;
    --warning:#f59e0b;
    --text:#e5f0ff;
    --muted:#94a3b8;
    --brand:#33654F;
  }
  *{box-sizing:border-box}
  body{
    margin:0;background:
      radial-gradient(1200px 500px at 50% -200px, #183058 0%, #0f1c37 55%, var(--bg) 100%);
    color:var(--text); font-family:'Cairo',system-ui; min-height:100dvh;
    display:flex; align-items:center; justify-content:center; padding:24px;
  }
  .game{
    width:min(980px,100%); background:linear-gradient(180deg,#0f1c37 0%,var(--panel) 100%);
    border:1px solid #1f2a44; border-radius:20px; overflow:hidden; position:relative;
    box-shadow:0 20px 60px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.04);
  }
  .hud{
    display:flex; gap:12px; padding:14px 16px; flex-wrap:wrap;
    background:linear-gradient(90deg,rgba(51,101,79,.35),rgba(45,212,191,.15));
    align-items:center; justify-content:space-between;
  }
  .stat{display:flex; gap:8px; align-items:center; padding:.35rem .65rem;
    background:#0d1730; border:1px solid #203054; border-radius:12px; color:var(--text)}
  .brand{font-weight:700; letter-spacing:.3px; display:flex; align-items:center; gap:8px}
  .brand em{font-style:normal; color:var(--accent)}
  .rpg{
    position:relative; height:160px; background:
      linear-gradient(#0e1a33 0,#0e1a33 70%, #071021 70%, #071021 100%);
    border-top:1px solid #1e2b4e; border-bottom:1px solid #1e2b4e;
    overflow:hidden;
  }
  .rpg .ground{position:absolute; inset:auto 0 0 0; height:54px;
    background:
      repeating-linear-gradient(90deg, #19325d 0 18px, #14294e 18px 36px);
    box-shadow:0 -8px 0 rgba(0,0,0,.25) inset;
  }
  .rpg .hero{position:absolute; bottom:54px; right:22px; width:46px; height:46px;
    background:radial-gradient(#34d399 30%,#10b981 65%,#059669 100%);
    border:2px solid #0ea5a5; border-radius:12px; box-shadow:0 6px 20px rgba(16,185,129,.35)}
  .rpg .coin{position:absolute; bottom:96px; right:86px; width:12px; height:12px;
    border-radius:50%; background:radial-gradient(#fde68a,#f59e0b); box-shadow:0 0 10px #f59e0b;}
  .card{padding:18px 16px 22px}
  .question{font-size:1.25rem; line-height:1.6; font-weight:700; margin:6px 0 14px}
  .answers{display:grid; gap:10px}
  .answers button{
    text-align:right; padding:12px 14px; border-radius:14px; border:1px solid #1f2a44;
    background:#0e1a33; color:var(--text); cursor:pointer; font-weight:700;
    transition:.2s ease; position:relative; isolation:isolate;
  }
  .answers button:hover{transform:translateY(-1px); box-shadow:0 8px 16px rgba(0,0,0,.25)}
  .answers button.correct{background:linear-gradient(90deg,#0e1a33, rgba(34,197,94,.25));
    border-color:#14532d; outline:2px solid rgba(34,197,94,.35)}
  .answers button.wrong{background:linear-gradient(90deg,#0e1a33, rgba(239,68,68,.22));
    border-color:#7f1d1d; outline:2px solid rgba(239,68,68,.35)}
  .timerTrack{height:8px; background:#0d1730; border:1px solid #203054; border-radius:999px; overflow:hidden}
  .timerBar{height:100%; width:100%; background:linear-gradient(90deg,var(--accent),#22c55e);
    transform-origin:right center; transition:width .1s linear}
  .toolbar{display:flex; gap:8px; flex-wrap:wrap; margin-top:12px}
  .tool{
    padding:.45rem .7rem; border:1px dashed #2a3d6f; border-radius:12px; background:#0e1a33;
    color:#bcd3ff; font-weight:700; cursor:not-allowed; opacity:.55
  }
  .tool.enabled{cursor:pointer; opacity:1; border-style:solid}
  .tool.used{opacity:.35; text-decoration:line-through}
  .foot{
    display:flex; justify-content:space-between; align-items:center; padding:12px 16px;
    border-top:1px solid #1f2a44; color:var(--muted); font-weight:700
  }
  .msg{padding:12px 14px; border-radius:12px; background:#0d1730; border:1px solid #203054; margin-top:12px}
  .cta{display:inline-flex; gap:10px; align-items:center; padding:10px 14px; border-radius:12px;
    background:linear-gradient(90deg,#22c55e,#2dd4bf); color:#062415; font-weight:900; border:0; cursor:pointer}
  .overlay{
    position:fixed; inset:0; background:rgba(4,9,20,.72); display:none; align-items:center; justify-content:center; z-index:30
  }
  .modal{
    width:min(520px,92%); background:linear-gradient(180deg,#0f1c37,#0e1a33); border:1px solid #1f2a44;
    color:var(--text); border-radius:16px; padding:18px 16px; box-shadow:0 40px 80px rgba(0,0,0,.45)
  }
  .audienceBars{display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-top:10px}
  .bar{background:#0d1730; border:1px solid #203054; height:120px; border-radius:10px; position:relative; overflow:hidden}
  .bar span{position:absolute; inset:auto 0 0 0; background:linear-gradient(#22c55e,#2dd4bf); width:100%}
  .bar em{position:absolute; top:6px; left:0; right:0; text-align:center; font-style:normal; color:#a5b4fc; font-weight:700}
  .small{font-size:.9rem; color:#9fb0d9}
</style>
</head>
<body>

<div class="game" id="game">
  <div class="hud">
    <div class="brand">⚔️ <em>RPG</em> تحدّي الأسئلة</div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <div class="stat">السؤال: <b id="qNum">1</b> / <b id="qTotal">100</b></div>
      <div class="stat">النتيجة: <b id="score">0</b></div>
      <div class="stat">الوقت: <b id="timeLeft">5</b> ث</div>
    </div>
  </div>

  <div class="rpg">
    <div class="hero" id="hero"></div>
    <div class="coin"></div>
    <div class="ground"></div>
  </div>

  <div class="card">
    <div class="timerTrack"><div class="timerBar" id="timerBar"></div></div>

    <div class="question" id="question">…</div>

    <div class="answers" id="answers"></div>

    <div class="toolbar">
      <button class="tool" id="fiftyTool" disabled>🧩 حذف إجابتين (بعد 20)</button>
      <button class="tool" id="audTool" disabled>📊 رأي الجمهور (بعد 40)</button>
    </div>

    <div class="msg small" id="statusMsg">أجب على 50 سؤالًا لتحصل على توصيلـة مجانية 🚚</div>
  </div>

  <div class="foot">
    <div>🎵 موسيقى خفيفة تعمل تلقائيًا — يمكنك كتمها من إعدادات المتصفح.</div>
    <div class="stat">مساعدات: <b id="helpers">0</b></div>
  </div>
</div>

<!-- Overlay: Audience Poll / Congratulation -->
<div class="overlay" id="overlay">
  <div class="modal" id="modal"></div>
</div>

<!-- أصوات -->
<audio id="bgm" loop>
  <source src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQAA" type="audio/mp3">
</audio>

<script>
/* ============ البيانات ============ */

/* ضع رقم واتساب بتاعك هنا (كود الدولة بدون +) */
const WHATSAPP_PHONE = "201234567890"; // مثال: 2010xxxxxxx

/* ألصق هنا قائمة الـ 100 سؤال (نص + 4 اختيارات + رقم الصحيحة) */
const questions = [
  // مثال للشكل:
  { q: "ما العاصمة الإدارية لدولة مصر قديمًا في عهد مينا موحِّد القطرين؟", a: ["طيبة","منف","أهناسيا","أواريس"], correct: 1 },
  { q: "أول خُطا الإسلام في الحبشة كانت في عهد من؟", a: ["عمر","عثمان","النبي ﷺ","أبو بكر"], correct: 2 },
  { q: "أطول نهر في العالم؟", a: ["الأمازون","النيجر","النيل","الدانوب"], correct: 2 },
  { q: "عِلم يهتم بدراسة الأديان والمعتقدات؟", a: ["اللاهوت المقارن","المسكوكات","الأنثروبولوجيا","الجغرافيا"], correct: 0 },
  { q: "غزوة وقعت في العام الثاني للهجرة؟", a: ["الخندق","بدر","أحد","حنين"], correct: 1 },
  { q: "مؤلف «نهج البلاغة» جامعًا؟", a: ["الشريف الرضي","الطبري","ابن كثير","الجاحظ"], correct: 0 },
  { q: "عدد الخلفاء الراشدين؟", a: ["ثلاثة","أربعة","خمسة","ستة"], correct: 1 },
  { q: "الكوكب الأحمر؟", a: ["الزهرة","عطارد","المريخ","نبتون"], correct: 2 },

  /* ===== الصق بقية الـ 100 سؤال هنا بنفس التنسيق ===== */
];

/* ============ حالة اللعبة ============ */
let idx = 0;               // رقم السؤال الحالي (0-based)
let score = 0;             // عدد الإجابات الصحيحة
let timer = null;          // المؤقّت
let timeLeft = 5;          // ثواني للسؤال
let usedFifty = false;     // هل استُخدم 50/50
let usedAudience = false;  // هل استُخدم رأي الجمهور
const TOTAL = questions.length || 100;

/* ============ عناصر DOM ============ */
const qNumEl = document.getElementById('qNum');
const qTotalEl = document.getElementById('qTotal');
const scoreEl = document.getElementById('score');
const timeLeftEl = document.getElementById('timeLeft');
const timerBar = document.getElementById('timerBar');
const qEl = document.getElementById('question');
const answersEl = document.getElementById('answers');
const statusMsg = document.getElementById('statusMsg');
const helpersEl = document.getElementById('helpers');

const fiftyBtn = document.getElementById('fiftyTool');
const audBtn = document.getElementById('audTool');

const overlay = document.getElementById('overlay');
const modal = document.getElementById('modal');

/* ============ أصوات (كليك/صواب/خطأ) ============ */
let audioCtx;
function clickSound(){
  try{
    audioCtx = audioCtx || new (window.AudioContext||window.webkitAudioContext)();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type="square"; o.frequency.value=880; g.gain.value=.04;
    o.connect(g).connect(audioCtx.destination);
    o.start(); setTimeout(()=>o.stop(),100);
  }catch(e){}
}
function rightSound(){
  try{
    audioCtx = audioCtx || new (window.AudioContext||window.webkitAudioContext)();
    const o = audioCtx.createOscillator(), g = audioCtx.createGain();
    o.type="sine"; o.frequency.setValueAtTime(520,audioCtx.currentTime);
    o.frequency.linearRampToValueAtTime(880,audioCtx.currentTime+.2);
    g.gain.value=.05; o.connect(g).connect(audioCtx.destination);
    o.start(); setTimeout(()=>o.stop(),220);
  }catch(e){}
}
function wrongSound(){
  try{
    audioCtx = audioCtx || new (window.AudioContext||window.webkitAudioContext)();
    const o = audioCtx.createOscillator(), g = audioCtx.createGain();
    o.type="sawtooth"; o.frequency.value=140; g.gain.value=.06;
    o.connect(g).connect(audioCtx.destination);
    o.start(); setTimeout(()=>o.stop(),180);
  }catch(e){}
}

/* ============ أدوات/مساعدات ============ */
function updateToolsState(){
  // 50/50 متاح بعد السؤال 20
  if(idx+1 >= 20 && !usedFifty){
    fiftyBtn.classList.add('enabled'); fiftyBtn.disabled=false;
  }
  // رأي الجمهور متاح بعد السؤال 40
  if(idx+1 >= 40 && !usedAudience){
    audBtn.classList.add('enabled'); audBtn.disabled=false;
  }
}
fiftyBtn.addEventListener('click',()=>{
  if(fiftyBtn.disabled) return;
  clickSound();
  usedFifty = true; fiftyBtn.classList.add('used'); fiftyBtn.disabled=true;

  // اخفِ إجابتين خاطئتين عشوائيتين
  const btns = [...answersEl.querySelectorAll('button')];
  const correctIndex = +answersEl.dataset.correct;
  const wrongs = btns.map((b,i)=>i).filter(i=>i!==correctIndex);
  shuffle(wrongs).slice(0,2).forEach(i=>btns[i].disabled=true);
});

audBtn.addEventListener('click',()=>{
  if(audBtn.disabled) return;
  clickSound();
  usedAudience = true; audBtn.classList.add('used'); audBtn.disabled=true;

  const choices = [...answersEl.querySelectorAll('button')].map(b=>b.textContent.trim());
  const correctIndex = +answersEl.dataset.correct;

  // انسب توزيع بنسب مائلة للصحيح
  const base = [15,20,25,40]; // مجموع 100
  shuffle(base);
  // اجعل الصحيح أعلى
  const maxIdx = base.indexOf(Math.max(...base));
  if(maxIdx !== correctIndex){
    [base[maxIdx], base[correctIndex]] = [base[correctIndex], base[maxIdx]];
  }

  showAudience(choices, base);
});

function showAudience(labels, perc){
  overlay.style.display='flex';
  modal.innerHTML = `
    <h3 style="margin:0 0 8px">📊 رأي الجمهور</h3>
    <div class="small">هذه النسب للاستئناس فقط.</div>
    <div class="audienceBars">
      ${labels.map((lab,i)=>`
        <div class="bar">
          <em>${lab}</em>
          <span style="height:${perc[i]}%"></span>
        </div>
      `).join('')}
    </div>
    <div style="margin-top:12px;display:flex;justify-content:flex-end">
      <button class="cta" onclick="document.getElementById('overlay').style.display='none'">حسنًا</button>
    </div>
  `;
}

/* ============ منطق المؤقّت ============ */
function startTimer(){
  stopTimer();
  timeLeft = 5;
  timeLeftEl.textContent = timeLeft;
  timerBar.style.width = "100%";
  const started = performance.now();
  timer = setInterval(()=>{
    const elapsed = (performance.now()-started)/1000;
    const left = Math.max(0, 5 - elapsed);
    timeLeftEl.textContent = left.toFixed(0);
    timerBar.style.width = (left/5*100) + "%";
    if(left<=0.05){
      stopTimer();
      handleAnswer(-1); // انتهى الوقت = خطأ
    }
  }, 80);
}
function stopTimer(){ if(timer){ clearInterval(timer); timer=null; } }

/* ============ عرض سؤال/إجابة ============ */
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }

function renderQuestion(){
  updateToolsState();
  const item = questions[idx];
  if(!item){ // لو خلصت الأسئلة الأقل من 100 (في حالة ما لصقتش القائمة كاملة)
    endAt100(); return;
  }
  qNumEl.textContent = idx+1;
  qTotalEl.textContent = TOTAL;
  qEl.textContent = item.q;

  answersEl.innerHTML = "";
  answersEl.dataset.correct = item.correct;
  const list = item.a.map((txt,i)=>({txt,i}));
  list.forEach(({txt,i})=>{
    const b = document.createElement('button');
    b.textContent = txt;
    b.addEventListener('click', ()=> handleAnswer(i));
    answersEl.appendChild(b);
  });

  startTimer();
}

function handleAnswer(choiceIndex){
  // امنع نقرات إضافية:
  [...answersEl.querySelectorAll('button')].forEach(b=>b.disabled=true);

  const correctIndex = +answersEl.dataset.correct;
  const btns = [...answersEl.querySelectorAll('button')];

  if(choiceIndex === correctIndex){
    rightSound();
    btns[choiceIndex].classList.add('correct');
    score++; scoreEl.textContent = score;

    // حرك البطل للأمام قليلًا (إحساس RPG)
    const hero = document.getElementById('hero');
    hero.animate([{transform:'translateX(0)'},{transform:'translateX(-20px)'}], {duration:300,fill:'forwards'});
  }else{
    wrongSound();
    if(choiceIndex>=0) btns[choiceIndex]?.classList.add('wrong');
    btns[correctIndex]?.classList.add('correct');
  }

  stopTimer();

  // مكافآت / حالات خاصة
  if(score === 50){
    congratsAt50();
    return;
  }
  if(idx === 99){ // السؤال رقم 100 (0-based)
    endAt100();
    return;
  }

  setTimeout(()=>{ idx++; renderQuestion(); }, 650);
}

/* ============ التهنئة عند 50 ============ */
function congratsAt50(){
  overlay.style.display='flex';
  const msg = encodeURIComponent("مرحبًا، فزت بتوصيلة مجانية من لعبة الأسئلة في موقع Fly Express ✅");
  const wa = `https://wa.me/${WHATSAPP_PHONE}?text=${msg}`;
  modal.innerHTML = `
    <h3 style="margin:0 0 8px">🎉 مبروك!</h3>
    <div class="msg">وصلت لـ <b>50</b> إجابة صحيحة! كسبت <b>توصيلة مجانية</b> 🚚.</div>
    <div class="msg small">اضغط لإرسال رسالة على واتساب لتأكيد الجائزة، ثم عُد وأكمل التحدّي حتى السؤال 100 لتحصل على <b>3 توصيلات مجانية</b>!</div>
    <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px">
      <a class="cta" href="${wa}" target="_blank" rel="noopener">إرسال رسالة واتساب</a>
      <button class="cta" onclick="document.getElementById('overlay').style.display='none'">رجوع للعبة</button>
    </div>
  `;
  statusMsg.innerHTML = "رائع! أرسل رسالة التأكيد على واتساب، ثم أكمل حتى السؤال 100 لتحصل على 3 توصيلات مجانية 🎁";
}

/* ============ النهاية عند 100 ============ */
function endAt100(){
  stopTimer();
  overlay.style.display='flex';
  modal.innerHTML = `
    <h3 style="margin:0 0 6px">🏁 إنهاء المستوى</h3>
    <div class="msg">أنهيت 100 سؤال. نتيجتك النهائية: <b>${score}</b> صحيحة.</div>
    <div class="msg">🎁 حصلت على <b>3 توصيلات مجانية</b> (بشرط إرسال رسالة التأكيد).</div>
    <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap">
      <button class="cta" onclick="location.reload()">إعادة من البداية</button>
    </div>
  `;
}

/* ============ تشغيل ============ */
function startGame(){
  // ابدأ الموسيقى (قد يتطلب تفاعل أول للمستخدم على بعض الأجهزة)
  const bgm = document.getElementById('bgm'); bgm.volume = 0.12; bgm.play().catch(()=>{});
  score = 0; idx = 0; scoreEl.textContent = "0"; usedFifty=false; usedAudience=false;
  fiftyBtn.classList.remove('enabled','used'); fiftyBtn.disabled=true;
  audBtn.classList.remove('enabled','used'); audBtn.disabled=true;
  helpersEl.textContent = "2"; // تُعتبر عدّاد مساعدات ظاهر فقط (رمزي)
  statusMsg.textContent = "أجب على 50 سؤالًا لتحصل على توصيلـة مجانية 🚚";
  renderQuestion();
}
startGame();

/* تسهيل: أي ضغطة على لوحة المفاتيح = كليك صوت */
window.addEventListener('keydown', clickSound, {once:true});
</script>
</body>
</html>
