<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ù…Ù† Ø³ÙŠØ±Ø¨Ø­ Ø§Ù„ØªÙˆØµÙŠÙ„Ø§ØªØŸ</title>
<link rel="manifest" href="manifest.json">
<style>
  :root{
    --bg:#0a1b3d;
    --panel:#0e2a63;
    --panel2:#14387f;
    --line:#52a0ff;
    --text:#eaf4ff;
    --ok:#19d27d;
    --bad:#ff3b3b;
    --warn:#ffc107;
    --glass: rgba(255,255,255,.06);
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:"Cairo",system-ui,sans-serif; color:var(--text);
    background: radial-gradient(1200px 600px at 50% -200px,#183a8d,transparent) , linear-gradient(#061330,#0a1b3d 30%, #071631);
    min-height:100vh; display:flex; align-items:center; justify-content:center; padding:16px;
  }
  .wrap{width:min(1000px,100%); }
  .top{
    display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:10px;
  }
  .logo{
    display:flex; align-items:center; gap:10px; font-weight:900; letter-spacing:1px;
    background:linear-gradient(135deg,#6ecbff,#b7e5ff); -webkit-background-clip:text; color:transparent;
    font-size:clamp(20px,3.4vw,32px);
  }
  .badge{background:var(--glass); padding:8px 12px; border:1px solid #2756aa; border-radius:999px; font-weight:700}
  .lifelines{display:flex; gap:8px; flex-wrap:wrap}
  .life{
    border:2px solid var(--line); color:#bfe2ff; background:linear-gradient(180deg, #163a86,#0e2a63);
    padding:8px 12px; border-radius:999px; font-weight:800; cursor:pointer; position:relative;
    box-shadow:0 0 0 2px rgba(82,160,255,.15) inset, 0 6px 18px rgba(0,0,0,.25);
  }
  .life:disabled{opacity:.45; filter:grayscale(1); cursor:not-allowed}
  .stage{
    background: radial-gradient(120% 100% at 50% -10%, #2557b6 0%, #0e2a63 65%, #0a1b3d 100%);
    border:2px solid var(--line); border-radius:20px; padding:18px; position:relative; overflow:hidden;
    box-shadow:0 0 30px rgba(82,160,255,.25) inset, 0 0 80px rgba(82,160,255,.15);
  }
  .timerBar{
    height:6px; border-radius:6px; background:linear-gradient(90deg,var(--ok),#2ad0ff,var(--warn),var(--bad));
    width:100%; transform-origin:left; margin:8px 0 14px; box-shadow:0 0 12px rgba(82,160,255,.4);
  }
  .q{
    background:linear-gradient(180deg,#163a86,#0e2a63);
    border:2px solid var(--line); border-radius:16px; padding:16px; font-weight:800; font-size:clamp(18px,2.2vw,22px);
    text-align:center; box-shadow:0 10px 24px rgba(0,0,0,.35);
  }
  .answers{display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:14px}
  .ans{
    position:relative; overflow:hidden; border-radius:999px; border:2px solid var(--line);
    background:linear-gradient(180deg,#14387f,#0f2f6b); padding:12px 16px; font-weight:800; cursor:pointer;
    box-shadow:0 0 0 2px rgba(82,160,255,.2) inset, 0 6px 18px rgba(0,0,0,.25);
  }
  .ans:disabled{opacity:.7; cursor:not-allowed}
  .ans.correct{border-color:var(--ok); background:linear-gradient(180deg,#0b6c4c,#0b4231)}
  .ans.wrong{border-color:var(--bad); background:linear-gradient(180deg,#7a0d0d,#430707)}
  .ladder{
    margin-top:14px; display:flex; gap:6px; flex-wrap:wrap; align-items:center; justify-content:center;
  }
  .step{border:1px solid #3c6ed8; padding:6px 10px; border-radius:999px; font-size:12px; opacity:.6}
  .activeStep{background:#1a3f95; color:#fff; opacity:1;border-color:#79b8ff}
  .modal{
    position:fixed; inset:0; display:none; place-items:center; background:rgba(3,8,20,.65); backdrop-filter:blur(2px); z-index:20;
  }
  .card{
    background:#0c1f4a; border:2px solid #5aa9ff; border-radius:18px; padding:20px; width:min(520px,92%);
    text-align:center; box-shadow:0 30px 80px rgba(0,0,0,.6);
  }
  .cta{
    background:linear-gradient(180deg,#1b77ff,#1256c7); color:#fff; font-weight:900; border:none; padding:10px 16px;
    border-radius:12px; cursor:pointer; box-shadow:0 10px 25px rgba(0,0,0,.35);
  }
  .foot{display:flex; justify-content:space-between; align-items:center; gap:10px; margin-top:10px; opacity:.9}
  .muted{opacity:.5}
</style>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body>
  <audio id="bgm" src="https://cdn.pixabay.com/audio/2023/10/03/audio_93c6b46b3e.mp3" loop></audio>
  <audio id="clickS" src="https://cdn.pixabay.com/audio/2022/03/15/audio_6e2b4e.mp3"></audio>
  <audio id="okS" src="https://cdn.pixabay.com/audio/2022/03/24/audio_5a7b66.mp3"></audio>
  <audio id="badS" src="https://cdn.pixabay.com/audio/2022/03/15/audio_6b0a8a.mp3"></audio>

  <div class="wrap">
    <div class="top">
      <div class="logo">Ù…Ù† Ø³ÙŠØ±Ø¨Ø­ <span style="color:#19d27d">Ø§Ù„ØªÙˆØµÙŠÙ„Ø§Øª</span>ØŸ</div>
      <div class="lifelines">
        <button class="life" id="fifty">50:50</button>
        <button class="life" id="aud">Ø±Ø£ÙŠ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±</button>
        <button class="life" id="mute">ÙƒØªÙ…/ØªØ´ØºÙŠÙ„</button>
        <div class="badge">Ø§Ù„Ø³Ø¤Ø§Ù„: <b id="qNo">1</b>/<b id="qTotal">70</b></div>
        <div class="badge">Ø§Ù„ÙˆÙ‚Øª: <b id="tRemain">5</b>Ø«</div>
      </div>
    </div>

    <div class="stage">
      <div id="timer" class="timerBar"></div>
      <div id="qTxt" class="q">â€¦</div>
      <div id="answers" class="answers"></div>
      <div id="ladder" class="ladder"></div>
      <div class="foot">
        <div>ğŸ“± ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© ÙŠØ±Ø³Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø³ØªÙˆÙŠØ§Øª 30/50/70.</div>
        <div class="muted">â±ï¸ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø© Ø£Ùˆ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª = Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©</div>
      </div>
    </div>
  </div>

  <div id="modal" class="modal">
    <div class="card">
      <div id="modalMsg" style="font-weight:900; font-size:20px; margin-bottom:12px">Ø±Ø³Ø§Ù„Ø©</div>
      <button id="restart" class="cta">Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø¬Ø¯ÙŠØ¯</button>
    </div>
  </div>

<script>
// --------- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© ----------
const WHATSAPP_PHONE = "201234567890"; // Ø¶Ø¹ Ù‡Ù†Ø§ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø¨ØµÙŠØºØ© Ø¯ÙˆÙ„ÙŠØ© Ø¨Ø¯ÙˆÙ† +
const QUESTION_TIME = 5;               // Ù…Ø¯Ø© ÙƒÙ„ Ø³Ø¤Ø§Ù„ Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ
const FINAL_TARGET  = 70;              // Ø¢Ø®Ø± Ø³Ø¤Ø§Ù„

// --------- Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (Ø£Ù…Ø«Ù„Ø© â€“ Ø¹Ø¯Ù‘Ù„ ÙˆØ£Ø¶ÙÙ Ø­ØªÙ‰ 70) ----------
/*
ÙƒÙ„ Ø¹Ù†ØµØ±:
q: Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„
a: Ù…ØµÙÙˆÙØ© 4 Ø¥Ø¬Ø§Ø¨Ø§Øª
c: ÙÙ‡Ø±Ø³ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© (0..3)
*/
const QUESTIONS = [
  {q:"Ø£ÙˆÙ„ Ù…Ù† Ø£Ø³Ù„Ù… Ù…Ù† Ø§Ù„ØµØ¨ÙŠØ§Ù†ØŸ", a:["Ø¹Ù„ÙŠ Ø¨Ù† Ø£Ø¨ÙŠ Ø·Ø§Ù„Ø¨","Ø²ÙŠØ¯ Ø¨Ù† Ø«Ø§Ø¨Øª","Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¨Ù† Ù…Ø³Ø¹ÙˆØ¯","Ø§Ù„Ø­Ø³Ù†"], c:0},
  {q:"Ø¹Ø§ØµÙ…Ø© Ø§Ù„ÙŠØ§Ø¨Ø§Ù†ØŸ", a:["Ø£ÙˆØ³Ø§ÙƒØ§","Ø·ÙˆÙƒÙŠÙˆ","Ù†Ø§ØºÙˆÙŠØ§","ÙƒÙŠÙˆØªÙˆ"], c:1},
  {q:"Ø§Ù„ØºØ§Ø² Ø§Ù„Ø°ÙŠ ØªÙ†ÙØ³Ù‡ Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª Ø§Ù„Ø­ÙŠØ©ØŸ", a:["Ø§Ù„Ù‡ÙŠØ¯Ø±ÙˆØ¬ÙŠÙ†","Ø§Ù„Ø£ÙƒØ³Ø¬ÙŠÙ†","Ø§Ù„Ù†ÙŠÙˆÙ†","Ø§Ù„Ø£Ø±Ø¬ÙˆÙ†"], c:1},
  {q:"ØºØ²ÙˆØ© Ø¨Ø¯Ø± ÙƒØ§Ù†Øª ÙÙŠ Ø§Ù„Ø³Ù†Ø©ØŸ", a:["Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ù„Ù„Ù‡Ø¬Ø±Ø©","Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù„Ù„Ù‡Ø¬Ø±Ø©","Ø§Ù„Ø«Ø§Ù„Ø«Ø© Ù„Ù„Ù‡Ø¬Ø±Ø©","Ø§Ù„Ø¹Ø§Ø´Ø±Ø© Ù„Ù„Ø¨Ø¹Ø«Ø©"], c:0},
  {q:"Ø£Ø·ÙˆÙ„ Ø£Ù†Ù‡Ø§Ø± Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ", a:["Ø§Ù„Ø£Ù…Ø§Ø²ÙˆÙ†","Ø§Ù„Ù†ÙŠÙ„","Ø§Ù„ÙŠØ§Ù†ØºØªØ³ÙŠ","Ø§Ù„ÙƒÙˆÙ†ØºÙˆ"], c:1},
  {q:"Ù…Ø¤Ù„Ù Ù…ÙˆØ·Ø£ Ù…Ø§Ù„ÙƒØŸ", a:["Ø§Ù„Ø´Ø§ÙØ¹ÙŠ","Ø£Ø­Ù…Ø¯","Ù…Ø§Ù„Ùƒ","Ø£Ø¨Ùˆ Ø­Ù†ÙŠÙØ©"], c:2},
  {q:"Ø³ÙˆØ±Ø© Ù„Ø§ ØªØ¨Ø¯Ø£ Ø¨Ø§Ù„Ø¨Ø³Ù…Ù„Ø©ØŸ", a:["Ø§Ù„ØªÙˆØ¨Ø©","Ø§Ù„Ø¥Ø®Ù„Ø§Øµ","Ø§Ù„ÙÙ„Ù‚","Ø§Ù„Ø¹Ù„Ù‚"], c:0},
  {q:"Ø§Ù„ÙƒØ¹Ø¨Ø© ØªÙ‚Ø¹ ÙÙŠØŸ", a:["Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©","Ù…ÙƒØ©","Ø§Ù„Ø·Ø§Ø¦Ù","Ø¬Ø¯Ø©"], c:1},
  {q:"Ø¹ÙØ¯Ù‘Ø© Ø§Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„Ù…ÙØ±ÙˆØ¶Ø©ØŸ", a:["Ø®Ù…Ø³","Ø£Ø±Ø¨Ø¹","Ø³Øª","Ø«Ù„Ø§Ø«"], c:0},
  {q:"Ø¹Ø§ØµÙ…Ø© ÙØ±Ù†Ø³Ø§ØŸ", a:["Ø¨Ø§Ø±ÙŠØ³","Ø±ÙˆÙ…Ø§","Ù…Ø¯Ø±ÙŠØ¯","Ø¨Ø±Ù„ÙŠÙ†"], c:0},
  {q:"ÙƒØ§ØªØ¨ Ø±ÙˆØ§ÙŠØ© Ø§Ù„Ù„Øµ ÙˆØ§Ù„ÙƒÙ„Ø§Ø¨ØŸ", a:["Ù†Ø¬ÙŠØ¨ Ù…Ø­ÙÙˆØ¸","Ø·Ù‡ Ø­Ø³ÙŠÙ†","Ø§Ù„Ø³Ø­Ù‘Ø§Ø±","Ø§Ù„Ø¹Ù‚Ø§Ø¯"], c:0},
  {q:"Ø£ÙƒØ¨Ø± ÙƒÙˆÙƒØ¨ ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ©ØŸ", a:["Ø²Ø­Ù„","Ø§Ù„Ù…Ø´ØªØ±ÙŠ","Ø£ÙˆØ±Ø§Ù†ÙˆØ³","Ù†Ø¨ØªÙˆÙ†"], c:1},
  {q:"Ù…Ø®ØªØ±Ø¹ Ø§Ù„Ù…ØµØ¨Ø§Ø­ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØŸ", a:["ØªØ³Ù„Ø§","Ø£Ø¯ÙŠØ³ÙˆÙ†","Ù…ÙˆØ±Ø³","ÙØ§Ø±Ø§Ø¯Ø§ÙŠ"], c:1},
  {q:"Ø¹Ø¯Ø¯ Ø£Ø±ÙƒØ§Ù† Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ØŸ", a:["Ø®Ù…Ø³Ø©","Ø£Ø±Ø¨Ø¹Ø©","Ø³ØªØ©","Ø³Ø¨Ø¹Ø©"], c:0},
  {q:"Ø§Ù„Ø³ÙˆØ±Ø© Ø§Ù„ØªÙŠ ØªØ³Ù…Ù‰ Ù‚Ù„Ø¨ Ø§Ù„Ù‚Ø±Ø¢Ù†ØŸ", a:["ÙŠØ³","Ø§Ù„ÙØ§ØªØ­Ø©","Ø§Ù„Ø¨Ù‚Ø±Ø©","Ø§Ù„Ø±Ø­Ù…Ù†"], c:0},
  {q:"Ø§Ù„Ù‚Ø§Ø±Ø© Ø§Ù„ØªÙŠ ØªØ¶Ù… Ù…ØµØ±ØŸ", a:["Ø¢Ø³ÙŠØ§","Ø£ÙØ±ÙŠÙ‚ÙŠØ§","Ø£ÙˆØ±ÙˆØ¨Ø§","Ø£Ø³ØªØ±Ø§Ù„ÙŠØ§"], c:1},
  {q:"Ù„ØºØ© Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„ Ø§Ù„Ø±Ø³Ù…ÙŠØ©ØŸ", a:["Ø§Ù„Ø¥Ø³Ø¨Ø§Ù†ÙŠØ©","Ø§Ù„Ø¨Ø±ØªØºØ§Ù„ÙŠØ©","Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©","Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©"], c:1},
  {q:"Ù…Ù† Ø§Ù„ØµØ­Ø§Ø¨ÙŠ Ø§Ù„Ù…Ù„Ù‚Ø¨ Ø¨Ø³ÙŠÙ Ø§Ù„Ù„Ù‡ØŸ", a:["Ø®Ø§Ù„Ø¯ Ø¨Ù† Ø§Ù„ÙˆÙ„ÙŠØ¯","Ø¹Ù…Ø±","Ø£Ø¨Ùˆ Ø¹Ø¨ÙŠØ¯Ø©","Ø­Ù…Ø²Ø©"], c:0},
  {q:"Ø£Ù‚Ø¯Ù… Ø¬Ø§Ù…Ø¹Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ", a:["Ø§Ù„Ù‚Ø±ÙˆÙŠÙŠÙ†","Ù‡Ø§Ø±ÙØ§Ø±Ø¯","Ø§Ù„Ø£Ø²Ù‡Ø±","Ø¨ÙˆÙ„ÙˆÙ†ÙŠØ§"], c:0},
  {q:"Ø¹Ø¯Ø¯ Ø£Ø­Ø±Ù Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©ØŸ", a:["28","29","27","26"], c:0},
  {q:"ÙƒÙ… Ø³Ø¬Ø¯Ø© ÙÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù†ØŸ", a:["15","14","13","12"], c:0},
  {q:"Ø¹Ø§ØµÙ…Ø© Ø§Ù„Ù…ØºØ±Ø¨ØŸ", a:["Ø§Ù„Ø¯Ø§Ø± Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡","Ø§Ù„Ø±Ø¨Ø§Ø·","Ù…Ø±Ø§ÙƒØ´","ÙØ§Ø³"], c:1},
  {q:"Ø§Ù„Ù…Ø­ÙŠØ· Ø§Ù„Ø£ÙƒØ¨Ø±ØŸ", a:["Ø§Ù„Ø£Ø·Ù„Ø³ÙŠ","Ø§Ù„Ù‡Ø§Ø¯ÙŠ","Ø§Ù„Ù‡Ù†Ø¯ÙŠ","Ø§Ù„Ù…ØªØ¬Ù…Ø¯"], c:1},
  {q:"Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠØ© Ø§Ù„ÙƒØ¨ÙŠØ³Ø© ÙÙŠÙ‡Ø§ØŸ", a:["366 ÙŠÙˆÙ…Ø§Ù‹","365 ÙŠÙˆÙ…Ø§Ù‹","364 ÙŠÙˆÙ…Ø§Ù‹","367 ÙŠÙˆÙ…Ø§Ù‹"], c:0},
  {q:"Ù…Ø®ØªØ±Ø¹ Ø§Ù„Ù‡Ø§ØªÙØŸ", a:["Ø¬Ø±Ø§Ù‡Ø§Ù… Ø¨ÙŠÙ„","Ø£Ø¯ÙŠØ³ÙˆÙ†","ØªØ³Ù„Ø§","Ù…Ø§Ø±ÙƒÙˆÙ†ÙŠ"], c:0},
];
// Ø¥Ù† ÙƒØ§Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ù‡Ø¯ÙØŒ Ù†ÙƒØ±Ù‘Ø± Ø¹Ø´ÙˆØ§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ù†ÙØ³ Ø§Ù„Ø¨Ù†Ùƒ (Ù…Ø¤Ù‚ØªÙ‹Ø§):
while(QUESTIONS.length < FINAL_TARGET){
  QUESTIONS.push(QUESTIONS[QUESTIONS.length % 25]);
}

// --------- Ø¹Ù†Ø§ØµØ± ÙˆØ§Ø¬Ù‡Ø© ----------
const qTxt     = document.getElementById('qTxt');
const answers  = document.getElementById('answers');
const qNoEl    = document.getElementById('qNo');
const qTotalEl = document.getElementById('qTotal');
const timerBar = document.getElementById('timer');
const tRemain  = document.getElementById('tRemain');
const ladder   = document.getElementById('ladder');
const modal    = document.getElementById('modal');
const modalMsg = document.getElementById('modalMsg');
const restart  = document.getElementById('restart');
const fiftyBtn = document.getElementById('fifty');
const audBtn   = document.getElementById('aud');
const muteBtn  = document.getElementById('mute');

const bgm   = document.getElementById('bgm');
const clickS= document.getElementById('clickS');
const okS   = document.getElementById('okS');
const badS  = document.getElementById('badS');

qTotalEl.textContent = FINAL_TARGET;

// --------- Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ----------
let idx=0, correctIndex=0, timer=null, left=QUESTION_TIME, running=false;
let usedFifty=false, usedAudience=false;
let muted=false;

// --------- ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© ----------
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
function play(s){ if(!muted){ try{s.currentTime=0; s.play()}catch(e){} } }
function waSend(msg){
  const url = `https://wa.me/${WHATSAPP_PHONE}?text=${encodeURIComponent(msg)}`;
  window.open(url,'_blank');
}
function showModal(msg){
  modalMsg.innerHTML = msg;
  modal.style.display='grid';
}
function hideModal(){ modal.style.display='none'; }

function resetLifelines(){
  usedFifty=false; usedAudience=false;
  fiftyBtn.disabled=false; audBtn.disabled=false;
}
function makeLadder(){
  ladder.innerHTML = "";
  for(let i=1;i<=FINAL_TARGET;i++){
    const d = document.createElement('div');
    d.className = 'step';
    d.textContent = i;
    if(i===30||i===50||i===70){ d.style.borderColor="#ffd66b"; d.style.color="#ffd66b"; d.style.fontWeight="900"; }
    ladder.appendChild(d);
  }
}
function markLadder(){
  const children=[...ladder.children];
  children.forEach((c,i)=>{ c.classList.toggle('activeStep', i===idx); });
}

// --------- Ø§Ù„Ù…Ø¤Ù‚Øª ----------
function startTimer(){
  stopTimer();
  left = QUESTION_TIME;
  tRemain.textContent = left;
  const start = Date.now();
  timer = setInterval(()=>{
    const elapsed = Math.floor((Date.now()-start)/1000);
    const remain  = Math.max(0, QUESTION_TIME - elapsed);
    tRemain.textContent = remain;
    const ratio = remain/QUESTION_TIME;
    timerBar.style.transform = `scaleX(${ratio})`;
    if(remain<=0){
      stopTimer();
      fail(); // Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª = Ø®Ø³Ø§Ø±Ø©
    }
  }, 200);
}
function stopTimer(){ if(timer){ clearInterval(timer); timer=null; } }

// --------- Ø±Ø³Ù… Ø§Ù„Ø³Ø¤Ø§Ù„ ----------
function render(){
  running=true;
  qNoEl.textContent = idx+1;
  qTxt.textContent = QUESTIONS[idx].q;

  // Ù†Ø¨Ù†ÙŠ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø¨ØªØ±ØªÙŠØ¨ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
  answers.innerHTML="";
  const order=[0,1,2,3]; shuffle(order);
  correctIndex = order.indexOf(QUESTIONS[idx].c);
  order.forEach((pos,i)=>{
    const b=document.createElement('button');
    b.className='ans';
    b.textContent = QUESTIONS[idx].a[pos];
    b.onclick = ()=> choose(i);
    answers.appendChild(b);
  });

  markLadder();
  startTimer();
}

// --------- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ----------
function choose(i){
  if(!running) return;
  play(clickS);
  running=false; stopTimer();
  const btns=[...answers.children];

  if(i===correctIndex){
    btns[i].classList.add('correct'); play(okS);
    setTimeout(()=>{
      // Ù…ÙƒØ§ÙØ¢Øª
      const qNumber = idx+1;
      if(qNumber===30){
        showModal("ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ÙƒØ³Ø¨Øª <b>ØªÙˆØµÙŠÙ„Ø© Ù…Ø¬Ø§Ù†ÙŠØ©</b> âœ…");
        waSend("ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ÙˆØµÙ„Øª Ù„Ù„Ø³Ø¤Ø§Ù„ 30 â€” ÙƒØ³Ø¨Øª ØªÙˆØµÙŠÙ„Ø© Ù…Ø¬Ø§Ù†ÙŠØ© Ù…Ù† Fly Express.");
      }
      if(qNumber===50){
        showModal("ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ÙƒØ³Ø¨Øª <b>ØªÙˆØµÙŠÙ„ØªÙŠÙ† Ù…Ø¬Ø§Ù†Ù‹Ø§</b> âœ…");
        waSend("ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ÙˆØµÙ„Øª Ù„Ù„Ø³Ø¤Ø§Ù„ 50 â€” ÙƒØ³Ø¨Øª ØªÙˆØµÙŠÙ„ØªÙŠÙ† Ù…Ø¬Ø§Ù†Ù‹Ø§ Ù…Ù† Fly Express.");
      }
      if(qNumber===70){
        showModal("ğŸ† Ù…Ø¨Ø±ÙˆÙƒ! Ø£Ù†Ù‡ÙŠØª Ø§Ù„Ù„Ø¹Ø¨Ø© â€” ÙƒØ³Ø¨Øª <b>3 ØªÙˆØµÙŠÙ„Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ©</b> ğŸ");
        waSend("ğŸ† Ù…Ø¨Ø±ÙˆÙƒ! Ø£Ù†Ù‡ÙŠØª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (70) â€” ÙƒØ³Ø¨Øª 3 ØªÙˆØµÙŠÙ„Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ© Ù…Ù† Fly Express.");
        return; // Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
      }
      // Ø§Ù„ØªØ§Ù„ÙŠ
      idx++;
      render();
    }, 650);
  }else{
    btns[i].classList.add('wrong');
    btns[correctIndex].classList.add('correct');
    play(badS);
    setTimeout(fail, 900);
  }
}

function fail(){
  showModal("âŒ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø© / Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª.<br>Ø³ØªØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ø³Ø¤Ø§Ù„ Ø±Ù‚Ù… <b>1</b>.");
}

// --------- Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ ----------
restart.onclick = ()=>{
  hideModal();
  idx=0; resetLifelines(); render();
};

// --------- Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø§Øª ----------
fiftyBtn.onclick = ()=>{
  if(usedFifty) return;
  usedFifty=true; fiftyBtn.disabled=true;

  // Ø§Ø­Ø°Ù Ø¥Ø¬Ø§Ø¨ØªÙŠÙ† Ø®Ø·Ø£
  const btns=[...answers.children];
  let removed=0;
  for(let i=0;i<btns.length;i++){
    if(i!==correctIndex && removed<2){
      btns[i].disabled=true; btns[i].style.opacity=.35;
      removed++;
    }
  }
};

audBtn.onclick = ()=>{
  if(usedAudience) return;
  usedAudience=true; audBtn.disabled=true;

  // ØªÙˆØ²ÙŠØ¹ Ù†Ø³Ø¨ Ø±Ø£ÙŠ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± (Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©)
  const bars=[0,0,0,0];
  let total=100, main=60+Math.floor(Math.random()*21); // 60-80 Ù„Ù„ØµØ­ÙŠØ­Ø©
  bars[correctIndex]=main; total-=main;
  for(let i=0;i<4;i++){
    if(i===correctIndex) continue;
    const v = (i<3? Math.floor(Math.random()*(total-(3-i))) : total);
    bars[i]=v; total-=v;
  }

  const poll = document.createElement('div');
  poll.style.cssText="position:absolute;inset:0;background:rgba(6,19,48,.85);display:grid;place-items:center;z-index:5;";
  poll.innerHTML=`
    <div class="card" style="width:min(520px,92%);">
      <div style="font-weight:900;margin-bottom:10px">ğŸ“Š Ø±Ø£ÙŠ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±</div>
      <div style="display:grid;gap:8px;text-align:start">
        ${bars.map((p,i)=>`<div><b>${String.fromCharCode(65+i)}:</b> 
          <span style="display:inline-block;height:10px;background:#52a0ff;width:${p*2}px;border-radius:6px;margin:0 6px -1px 6px"></span>
          <b>${p}%</b></div>`).join("")}
      </div>
      <button class="cta" style="margin-top:14px" id="closePoll">Ø­Ø³Ù†Ø§Ù‹</button>
    </div>`;
  document.body.appendChild(poll);
  document.getElementById('closePoll').onclick = ()=> poll.remove();
};

// --------- ÙƒØªÙ…/ØªØ´ØºÙŠÙ„ ----------
muteBtn.onclick = ()=>{
  muted = !muted;
  if(muted) bgm.pause(); else bgm.play().catch(()=>{});
  muteBtn.classList.toggle('muted', muted);
};

// --------- ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ ----------
makeLadder();
resetLifelines();
render();
bgm.volume=0.5; bgm.play().catch(()=>{ /* Ù…ØªØµÙØ­ Ù‚Ø¯ ÙŠÙ…Ù†Ø¹ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ */ });

</script>
</body>
</html>
