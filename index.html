<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© - RPG</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0b1324;
    --panel:#111b34;
    --accent:#2dd4bf;
    --accent2:#22c55e;
    --danger:#ef4444;
    --warning:#f59e0b;
    --text:#e5f0ff;
    --muted:#94a3b8;
    --brand:#33654F;
  }
  *{box-sizing:border-box}
  body{
    margin:0;background:
      radial-gradient(1200px 500px at 50% -200px, #183058 0%, #0f1c37 55%, var(--bg) 100%);
    color:var(--text); font-family:'Cairo',system-ui; min-height:100dvh;
    display:flex; align-items:center; justify-content:center; padding:24px;
  }
  .game{
    width:min(980px,100%); background:linear-gradient(180deg,#0f1c37 0%,var(--panel) 100%);
    border:1px solid #1f2a44; border-radius:20px; overflow:hidden; position:relative;
    box-shadow:0 20px 60px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.04);
  }
  .hud{
    display:flex; gap:12px; padding:14px 16px; flex-wrap:wrap;
    background:linear-gradient(90deg,rgba(51,101,79,.35),rgba(45,212,191,.15));
    align-items:center; justify-content:space-between;
  }
  .stat{display:flex; gap:8px; align-items:center; padding:.35rem .65rem;
    background:#0d1730; border:1px solid #203054; border-radius:12px; color:var(--text)}
  .brand{font-weight:700; letter-spacing:.3px; display:flex; align-items:center; gap:8px}
  .brand em{font-style:normal; color:var(--accent)}
  .rpg{
    position:relative; height:160px; background:
      linear-gradient(#0e1a33 0,#0e1a33 70%, #071021 70%, #071021 100%);
    border-top:1px solid #1e2b4e; border-bottom:1px solid #1e2b4e;
    overflow:hidden;
  }
  .rpg .ground{position:absolute; inset:auto 0 0 0; height:54px;
    background:
      repeating-linear-gradient(90deg, #19325d 0 18px, #14294e 18px 36px);
    box-shadow:0 -8px 0 rgba(0,0,0,.25) inset;
  }
  .rpg .hero{position:absolute; bottom:54px; right:22px; width:46px; height:46px;
    background:radial-gradient(#34d399 30%,#10b981 65%,#059669 100%);
    border:2px solid #0ea5a5; border-radius:12px; box-shadow:0 6px 20px rgba(16,185,129,.35)}
  .rpg .coin{position:absolute; bottom:96px; right:86px; width:12px; height:12px;
    border-radius:50%; background:radial-gradient(#fde68a,#f59e0b); box-shadow:0 0 10px #f59e0b;}
  .card{padding:18px 16px 22px}
  .question{font-size:1.25rem; line-height:1.6; font-weight:700; margin:6px 0 14px}
  .answers{display:grid; gap:10px}
  .answers button{
    text-align:right; padding:12px 14px; border-radius:14px; border:1px solid #1f2a44;
    background:#0e1a33; color:var(--text); cursor:pointer; font-weight:700;
    transition:.2s ease; position:relative; isolation:isolate;
  }
  .answers button:hover{transform:translateY(-1px); box-shadow:0 8px 16px rgba(0,0,0,.25)}
  .answers button.correct{background:linear-gradient(90deg,#0e1a33, rgba(34,197,94,.25));
    border-color:#14532d; outline:2px solid rgba(34,197,94,.35)}
  .answers button.wrong{background:linear-gradient(90deg,#0e1a33, rgba(239,68,68,.22));
    border-color:#7f1d1d; outline:2px solid rgba(239,68,68,.35)}
  .timerTrack{height:8px; background:#0d1730; border:1px solid #203054; border-radius:999px; overflow:hidden}
  .timerBar{height:100%; width:100%; background:linear-gradient(90deg,var(--accent),#22c55e);
    transform-origin:right center; transition:width .1s linear}
  .toolbar{display:flex; gap:8px; flex-wrap:wrap; margin-top:12px}
  .tool{
    padding:.45rem .7rem; border:1px dashed #2a3d6f; border-radius:12px; background:#0e1a33;
    color:#bcd3ff; font-weight:700; cursor:not-allowed; opacity:.55
  }
  .tool.enabled{cursor:pointer; opacity:1; border-style:solid}
  .tool.used{opacity:.35; text-decoration:line-through}
  .foot{
    display:flex; justify-content:space-between; align-items:center; padding:12px 16px;
    border-top:1px solid #1f2a44; color:var(--muted); font-weight:700
  }
  .msg{padding:12px 14px; border-radius:12px; background:#0d1730; border:1px solid #203054; margin-top:12px}
  .cta{display:inline-flex; gap:10px; align-items:center; padding:10px 14px; border-radius:12px;
    background:linear-gradient(90deg,#22c55e,#2dd4bf); color:#062415; font-weight:900; border:0; cursor:pointer}
  .overlay{
    position:fixed; inset:0; background:rgba(4,9,20,.72); display:none; align-items:center; justify-content:center; z-index:30
  }
  .modal{
    width:min(520px,92%); background:linear-gradient(180deg,#0f1c37,#0e1a33); border:1px solid #1f2a44;
    color:var(--text); border-radius:16px; padding:18px 16px; box-shadow:0 40px 80px rgba(0,0,0,.45)
  }
  .audienceBars{display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-top:10px}
  .bar{background:#0d1730; border:1px solid #203054; height:120px; border-radius:10px; position:relative; overflow:hidden}
  .bar span{position:absolute; inset:auto 0 0 0; background:linear-gradient(#22c55e,#2dd4bf); width:100%}
  .bar em{position:absolute; top:6px; left:0; right:0; text-align:center; font-style:normal; color:#a5b4fc; font-weight:700}
  .small{font-size:.9rem; color:#9fb0d9}
</style>
</head>
<body>

<div class="game" id="game">
  <div class="hud">
    <div class="brand">âš”ï¸ <em>RPG</em> ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <div class="stat">Ø§Ù„Ø³Ø¤Ø§Ù„: <b id="qNum">1</b> / <b id="qTotal">100</b></div>
      <div class="stat">Ø§Ù„Ù†ØªÙŠØ¬Ø©: <b id="score">0</b></div>
      <div class="stat">Ø§Ù„ÙˆÙ‚Øª: <b id="timeLeft">5</b> Ø«</div>
    </div>
  </div>

  <div class="rpg">
    <div class="hero" id="hero"></div>
    <div class="coin"></div>
    <div class="ground"></div>
  </div>

  <div class="card">
    <div class="timerTrack"><div class="timerBar" id="timerBar"></div></div>

    <div class="question" id="question">â€¦</div>

    <div class="answers" id="answers"></div>

    <div class="toolbar">
      <button class="tool" id="fiftyTool" disabled>ğŸ§© Ø­Ø°Ù Ø¥Ø¬Ø§Ø¨ØªÙŠÙ† (Ø¨Ø¹Ø¯ 20)</button>
      <button class="tool" id="audTool" disabled>ğŸ“Š Ø±Ø£ÙŠ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± (Ø¨Ø¹Ø¯ 40)</button>
    </div>

    <div class="msg small" id="statusMsg">Ø£Ø¬Ø¨ Ø¹Ù„Ù‰ 50 Ø³Ø¤Ø§Ù„Ù‹Ø§ Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ ØªÙˆØµÙŠÙ„Ù€Ø© Ù…Ø¬Ø§Ù†ÙŠØ© ğŸšš</div>
  </div>

  <div class="foot">
    <div>ğŸµ Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø®ÙÙŠÙØ© ØªØ¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ â€” ÙŠÙ…ÙƒÙ†Ùƒ ÙƒØªÙ…Ù‡Ø§ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­.</div>
    <div class="stat">Ù…Ø³Ø§Ø¹Ø¯Ø§Øª: <b id="helpers">0</b></div>
  </div>
</div>

<!-- Overlay: Audience Poll / Congratulation -->
<div class="overlay" id="overlay">
  <div class="modal" id="modal"></div>
</div>

<!-- Ø£ØµÙˆØ§Øª -->
<audio id="bgm" loop>
  <source src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQAA" type="audio/mp3">
</audio>

<script>
/* ============ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ============ */

/* Ø¶Ø¹ Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø¨ØªØ§Ø¹Ùƒ Ù‡Ù†Ø§ (ÙƒÙˆØ¯ Ø§Ù„Ø¯ÙˆÙ„Ø© Ø¨Ø¯ÙˆÙ† +) */
const WHATSAPP_PHONE = "201234567890"; // Ù…Ø«Ø§Ù„: 2010xxxxxxx

/* Ø£Ù„ØµÙ‚ Ù‡Ù†Ø§ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù€ 100 Ø³Ø¤Ø§Ù„ (Ù†Øµ + 4 Ø§Ø®ØªÙŠØ§Ø±Ø§Øª + Ø±Ù‚Ù… Ø§Ù„ØµØ­ÙŠØ­Ø©) */
const questions = [
  // Ù…Ø«Ø§Ù„ Ù„Ù„Ø´ÙƒÙ„:
  { q: "Ù…Ø§ Ø§Ù„Ø¹Ø§ØµÙ…Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© Ù„Ø¯ÙˆÙ„Ø© Ù…ØµØ± Ù‚Ø¯ÙŠÙ…Ù‹Ø§ ÙÙŠ Ø¹Ù‡Ø¯ Ù…ÙŠÙ†Ø§ Ù…ÙˆØ­Ù‘ÙØ¯ Ø§Ù„Ù‚Ø·Ø±ÙŠÙ†ØŸ", a: ["Ø·ÙŠØ¨Ø©","Ù…Ù†Ù","Ø£Ù‡Ù†Ø§Ø³ÙŠØ§","Ø£ÙˆØ§Ø±ÙŠØ³"], correct: 1 },
  { q: "Ø£ÙˆÙ„ Ø®ÙØ·Ø§ Ø§Ù„Ø¥Ø³Ù„Ø§Ù… ÙÙŠ Ø§Ù„Ø­Ø¨Ø´Ø© ÙƒØ§Ù†Øª ÙÙŠ Ø¹Ù‡Ø¯ Ù…Ù†ØŸ", a: ["Ø¹Ù…Ø±","Ø¹Ø«Ù…Ø§Ù†","Ø§Ù„Ù†Ø¨ÙŠ ï·º","Ø£Ø¨Ùˆ Ø¨ÙƒØ±"], correct: 2 },
  { q: "Ø£Ø·ÙˆÙ„ Ù†Ù‡Ø± ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ", a: ["Ø§Ù„Ø£Ù…Ø§Ø²ÙˆÙ†","Ø§Ù„Ù†ÙŠØ¬Ø±","Ø§Ù„Ù†ÙŠÙ„","Ø§Ù„Ø¯Ø§Ù†ÙˆØ¨"], correct: 2 },
  { q: "Ø¹ÙÙ„Ù… ÙŠÙ‡ØªÙ… Ø¨Ø¯Ø±Ø§Ø³Ø© Ø§Ù„Ø£Ø¯ÙŠØ§Ù† ÙˆØ§Ù„Ù…Ø¹ØªÙ‚Ø¯Ø§ØªØŸ", a: ["Ø§Ù„Ù„Ø§Ù‡ÙˆØª Ø§Ù„Ù…Ù‚Ø§Ø±Ù†","Ø§Ù„Ù…Ø³ÙƒÙˆÙƒØ§Øª","Ø§Ù„Ø£Ù†Ø«Ø±ÙˆØ¨ÙˆÙ„ÙˆØ¬ÙŠØ§","Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§"], correct: 0 },
  { q: "ØºØ²ÙˆØ© ÙˆÙ‚Ø¹Øª ÙÙŠ Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ Ù„Ù„Ù‡Ø¬Ø±Ø©ØŸ", a: ["Ø§Ù„Ø®Ù†Ø¯Ù‚","Ø¨Ø¯Ø±","Ø£Ø­Ø¯","Ø­Ù†ÙŠÙ†"], correct: 1 },
  { q: "Ù…Ø¤Ù„Ù Â«Ù†Ù‡Ø¬ Ø§Ù„Ø¨Ù„Ø§ØºØ©Â» Ø¬Ø§Ù…Ø¹Ù‹Ø§ØŸ", a: ["Ø§Ù„Ø´Ø±ÙŠÙ Ø§Ù„Ø±Ø¶ÙŠ","Ø§Ù„Ø·Ø¨Ø±ÙŠ","Ø§Ø¨Ù† ÙƒØ«ÙŠØ±","Ø§Ù„Ø¬Ø§Ø­Ø¸"], correct: 0 },
  { q: "Ø¹Ø¯Ø¯ Ø§Ù„Ø®Ù„ÙØ§Ø¡ Ø§Ù„Ø±Ø§Ø´Ø¯ÙŠÙ†ØŸ", a: ["Ø«Ù„Ø§Ø«Ø©","Ø£Ø±Ø¨Ø¹Ø©","Ø®Ù…Ø³Ø©","Ø³ØªØ©"], correct: 1 },
  { q: "Ø§Ù„ÙƒÙˆÙƒØ¨ Ø§Ù„Ø£Ø­Ù…Ø±ØŸ", a: ["Ø§Ù„Ø²Ù‡Ø±Ø©","Ø¹Ø·Ø§Ø±Ø¯","Ø§Ù„Ù…Ø±ÙŠØ®","Ù†Ø¨ØªÙˆÙ†"], correct: 2 },

  /* ===== Ø§Ù„ØµÙ‚ Ø¨Ù‚ÙŠØ© Ø§Ù„Ù€ 100 Ø³Ø¤Ø§Ù„ Ù‡Ù†Ø§ Ø¨Ù†ÙØ³ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ ===== */
];

/* ============ Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ============ */
let idx = 0;               // Ø±Ù‚Ù… Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ (0-based)
let score = 0;             // Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©
let timer = null;          // Ø§Ù„Ù…Ø¤Ù‚Ù‘Øª
let timeLeft = 5;          // Ø«ÙˆØ§Ù†ÙŠ Ù„Ù„Ø³Ø¤Ø§Ù„
let usedFifty = false;     // Ù‡Ù„ Ø§Ø³ØªÙØ®Ø¯Ù… 50/50
let usedAudience = false;  // Ù‡Ù„ Ø§Ø³ØªÙØ®Ø¯Ù… Ø±Ø£ÙŠ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±
const TOTAL = questions.length || 100;

/* ============ Ø¹Ù†Ø§ØµØ± DOM ============ */
const qNumEl = document.getElementById('qNum');
const qTotalEl = document.getElementById('qTotal');
const scoreEl = document.getElementById('score');
const timeLeftEl = document.getElementById('timeLeft');
const timerBar = document.getElementById('timerBar');
const qEl = document.getElementById('question');
const answersEl = document.getElementById('answers');
const statusMsg = document.getElementById('statusMsg');
const helpersEl = document.getElementById('helpers');

const fiftyBtn = document.getElementById('fiftyTool');
const audBtn = document.getElementById('audTool');

const overlay = document.getElementById('overlay');
const modal = document.getElementById('modal');

/* ============ Ø£ØµÙˆØ§Øª (ÙƒÙ„ÙŠÙƒ/ØµÙˆØ§Ø¨/Ø®Ø·Ø£) ============ */
let audioCtx;
function clickSound(){
  try{
    audioCtx = audioCtx || new (window.AudioContext||window.webkitAudioContext)();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type="square"; o.frequency.value=880; g.gain.value=.04;
    o.connect(g).connect(audioCtx.destination);
    o.start(); setTimeout(()=>o.stop(),100);
  }catch(e){}
}
function rightSound(){
  try{
    audioCtx = audioCtx || new (window.AudioContext||window.webkitAudioContext)();
    const o = audioCtx.createOscillator(), g = audioCtx.createGain();
    o.type="sine"; o.frequency.setValueAtTime(520,audioCtx.currentTime);
    o.frequency.linearRampToValueAtTime(880,audioCtx.currentTime+.2);
    g.gain.value=.05; o.connect(g).connect(audioCtx.destination);
    o.start(); setTimeout(()=>o.stop(),220);
  }catch(e){}
}
function wrongSound(){
  try{
    audioCtx = audioCtx || new (window.AudioContext||window.webkitAudioContext)();
    const o = audioCtx.createOscillator(), g = audioCtx.createGain();
    o.type="sawtooth"; o.frequency.value=140; g.gain.value=.06;
    o.connect(g).connect(audioCtx.destination);
    o.start(); setTimeout(()=>o.stop(),180);
  }catch(e){}
}

/* ============ Ø£Ø¯ÙˆØ§Øª/Ù…Ø³Ø§Ø¹Ø¯Ø§Øª ============ */
function updateToolsState(){
  // 50/50 Ù…ØªØ§Ø­ Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø¤Ø§Ù„ 20
  if(idx+1 >= 20 && !usedFifty){
    fiftyBtn.classList.add('enabled'); fiftyBtn.disabled=false;
  }
  // Ø±Ø£ÙŠ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± Ù…ØªØ§Ø­ Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø¤Ø§Ù„ 40
  if(idx+1 >= 40 && !usedAudience){
    audBtn.classList.add('enabled'); audBtn.disabled=false;
  }
}
fiftyBtn.addEventListener('click',()=>{
  if(fiftyBtn.disabled) return;
  clickSound();
  usedFifty = true; fiftyBtn.classList.add('used'); fiftyBtn.disabled=true;

  // Ø§Ø®ÙÙ Ø¥Ø¬Ø§Ø¨ØªÙŠÙ† Ø®Ø§Ø·Ø¦ØªÙŠÙ† Ø¹Ø´ÙˆØ§Ø¦ÙŠØªÙŠÙ†
  const btns = [...answersEl.querySelectorAll('button')];
  const correctIndex = +answersEl.dataset.correct;
  const wrongs = btns.map((b,i)=>i).filter(i=>i!==correctIndex);
  shuffle(wrongs).slice(0,2).forEach(i=>btns[i].disabled=true);
});

audBtn.addEventListener('click',()=>{
  if(audBtn.disabled) return;
  clickSound();
  usedAudience = true; audBtn.classList.add('used'); audBtn.disabled=true;

  const choices = [...answersEl.querySelectorAll('button')].map(b=>b.textContent.trim());
  const correctIndex = +answersEl.dataset.correct;

  // Ø§Ù†Ø³Ø¨ ØªÙˆØ²ÙŠØ¹ Ø¨Ù†Ø³Ø¨ Ù…Ø§Ø¦Ù„Ø© Ù„Ù„ØµØ­ÙŠØ­
  const base = [15,20,25,40]; // Ù…Ø¬Ù…ÙˆØ¹ 100
  shuffle(base);
  // Ø§Ø¬Ø¹Ù„ Ø§Ù„ØµØ­ÙŠØ­ Ø£Ø¹Ù„Ù‰
  const maxIdx = base.indexOf(Math.max(...base));
  if(maxIdx !== correctIndex){
    [base[maxIdx], base[correctIndex]] = [base[correctIndex], base[maxIdx]];
  }

  showAudience(choices, base);
});

function showAudience(labels, perc){
  overlay.style.display='flex';
  modal.innerHTML = `
    <h3 style="margin:0 0 8px">ğŸ“Š Ø±Ø£ÙŠ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±</h3>
    <div class="small">Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø³Ø¨ Ù„Ù„Ø§Ø³ØªØ¦Ù†Ø§Ø³ ÙÙ‚Ø·.</div>
    <div class="audienceBars">
      ${labels.map((lab,i)=>`
        <div class="bar">
          <em>${lab}</em>
          <span style="height:${perc[i]}%"></span>
        </div>
      `).join('')}
    </div>
    <div style="margin-top:12px;display:flex;justify-content:flex-end">
      <button class="cta" onclick="document.getElementById('overlay').style.display='none'">Ø­Ø³Ù†Ù‹Ø§</button>
    </div>
  `;
}

/* ============ Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø¤Ù‚Ù‘Øª ============ */
function startTimer(){
  stopTimer();
  timeLeft = 5;
  timeLeftEl.textContent = timeLeft;
  timerBar.style.width = "100%";
  const started = performance.now();
  timer = setInterval(()=>{
    const elapsed = (performance.now()-started)/1000;
    const left = Math.max(0, 5 - elapsed);
    timeLeftEl.textContent = left.toFixed(0);
    timerBar.style.width = (left/5*100) + "%";
    if(left<=0.05){
      stopTimer();
      handleAnswer(-1); // Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª = Ø®Ø·Ø£
    }
  }, 80);
}
function stopTimer(){ if(timer){ clearInterval(timer); timer=null; } }

/* ============ Ø¹Ø±Ø¶ Ø³Ø¤Ø§Ù„/Ø¥Ø¬Ø§Ø¨Ø© ============ */
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }

function renderQuestion(){
  updateToolsState();
  const item = questions[idx];
  if(!item){ // Ù„Ùˆ Ø®Ù„ØµØª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø£Ù‚Ù„ Ù…Ù† 100 (ÙÙŠ Ø­Ø§Ù„Ø© Ù…Ø§ Ù„ØµÙ‚ØªØ´ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙƒØ§Ù…Ù„Ø©)
    endAt100(); return;
  }
  qNumEl.textContent = idx+1;
  qTotalEl.textContent = TOTAL;
  qEl.textContent = item.q;

  answersEl.innerHTML = "";
  answersEl.dataset.correct = item.correct;
  const list = item.a.map((txt,i)=>({txt,i}));
  list.forEach(({txt,i})=>{
    const b = document.createElement('button');
    b.textContent = txt;
    b.addEventListener('click', ()=> handleAnswer(i));
    answersEl.appendChild(b);
  });

  startTimer();
}

function handleAnswer(choiceIndex){
  // Ø§Ù…Ù†Ø¹ Ù†Ù‚Ø±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:
  [...answersEl.querySelectorAll('button')].forEach(b=>b.disabled=true);

  const correctIndex = +answersEl.dataset.correct;
  const btns = [...answersEl.querySelectorAll('button')];

  if(choiceIndex === correctIndex){
    rightSound();
    btns[choiceIndex].classList.add('correct');
    score++; scoreEl.textContent = score;

    // Ø­Ø±Ùƒ Ø§Ù„Ø¨Ø·Ù„ Ù„Ù„Ø£Ù…Ø§Ù… Ù‚Ù„ÙŠÙ„Ù‹Ø§ (Ø¥Ø­Ø³Ø§Ø³ RPG)
    const hero = document.getElementById('hero');
    hero.animate([{transform:'translateX(0)'},{transform:'translateX(-20px)'}], {duration:300,fill:'forwards'});
  }else{
    wrongSound();
    if(choiceIndex>=0) btns[choiceIndex]?.classList.add('wrong');
    btns[correctIndex]?.classList.add('correct');
  }

  stopTimer();

  // Ù…ÙƒØ§ÙØ¢Øª / Ø­Ø§Ù„Ø§Øª Ø®Ø§ØµØ©
  if(score === 50){
    congratsAt50();
    return;
  }
  if(idx === 99){ // Ø§Ù„Ø³Ø¤Ø§Ù„ Ø±Ù‚Ù… 100 (0-based)
    endAt100();
    return;
  }

  setTimeout(()=>{ idx++; renderQuestion(); }, 650);
}

/* ============ Ø§Ù„ØªÙ‡Ù†Ø¦Ø© Ø¹Ù†Ø¯ 50 ============ */
function congratsAt50(){
  overlay.style.display='flex';
  const msg = encodeURIComponent("Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ ÙØ²Øª Ø¨ØªÙˆØµÙŠÙ„Ø© Ù…Ø¬Ø§Ù†ÙŠØ© Ù…Ù† Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ù…ÙˆÙ‚Ø¹ Fly Express âœ…");
  const wa = `https://wa.me/${WHATSAPP_PHONE}?text=${msg}`;
  modal.innerHTML = `
    <h3 style="margin:0 0 8px">ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ!</h3>
    <div class="msg">ÙˆØµÙ„Øª Ù„Ù€ <b>50</b> Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! ÙƒØ³Ø¨Øª <b>ØªÙˆØµÙŠÙ„Ø© Ù…Ø¬Ø§Ù†ÙŠØ©</b> ğŸšš.</div>
    <div class="msg small">Ø§Ø¶ØºØ· Ù„Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©ØŒ Ø«Ù… Ø¹ÙØ¯ ÙˆØ£ÙƒÙ…Ù„ Ø§Ù„ØªØ­Ø¯Ù‘ÙŠ Ø­ØªÙ‰ Ø§Ù„Ø³Ø¤Ø§Ù„ 100 Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ <b>3 ØªÙˆØµÙŠÙ„Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ©</b>!</div>
    <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px">
      <a class="cta" href="${wa}" target="_blank" rel="noopener">Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨</a>
      <button class="cta" onclick="document.getElementById('overlay').style.display='none'">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø¹Ø¨Ø©</button>
    </div>
  `;
  statusMsg.innerHTML = "Ø±Ø§Ø¦Ø¹! Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨ØŒ Ø«Ù… Ø£ÙƒÙ…Ù„ Ø­ØªÙ‰ Ø§Ù„Ø³Ø¤Ø§Ù„ 100 Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ 3 ØªÙˆØµÙŠÙ„Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ© ğŸ";
}

/* ============ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø¹Ù†Ø¯ 100 ============ */
function endAt100(){
  stopTimer();
  overlay.style.display='flex';
  modal.innerHTML = `
    <h3 style="margin:0 0 6px">ğŸ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙˆÙ‰</h3>
    <div class="msg">Ø£Ù†Ù‡ÙŠØª 100 Ø³Ø¤Ø§Ù„. Ù†ØªÙŠØ¬ØªÙƒ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: <b>${score}</b> ØµØ­ÙŠØ­Ø©.</div>
    <div class="msg">ğŸ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ <b>3 ØªÙˆØµÙŠÙ„Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ©</b> (Ø¨Ø´Ø±Ø· Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯).</div>
    <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap">
      <button class="cta" onclick="location.reload()">Ø¥Ø¹Ø§Ø¯Ø© Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</button>
    </div>
  `;
}

/* ============ ØªØ´ØºÙŠÙ„ ============ */
function startGame(){
  // Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ (Ù‚Ø¯ ÙŠØªØ·Ù„Ø¨ ØªÙØ§Ø¹Ù„ Ø£ÙˆÙ„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ù‰ Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©)
  const bgm = document.getElementById('bgm'); bgm.volume = 0.12; bgm.play().catch(()=>{});
  score = 0; idx = 0; scoreEl.textContent = "0"; usedFifty=false; usedAudience=false;
  fiftyBtn.classList.remove('enabled','used'); fiftyBtn.disabled=true;
  audBtn.classList.remove('enabled','used'); audBtn.disabled=true;
  helpersEl.textContent = "2"; // ØªÙØ¹ØªØ¨Ø± Ø¹Ø¯Ù‘Ø§Ø¯ Ù…Ø³Ø§Ø¹Ø¯Ø§Øª Ø¸Ø§Ù‡Ø± ÙÙ‚Ø· (Ø±Ù…Ø²ÙŠ)
  statusMsg.textContent = "Ø£Ø¬Ø¨ Ø¹Ù„Ù‰ 50 Ø³Ø¤Ø§Ù„Ù‹Ø§ Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ ØªÙˆØµÙŠÙ„Ù€Ø© Ù…Ø¬Ø§Ù†ÙŠØ© ğŸšš";
  renderQuestion();
}
startGame();

/* ØªØ³Ù‡ÙŠÙ„: Ø£ÙŠ Ø¶ØºØ·Ø© Ø¹Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ = ÙƒÙ„ÙŠÙƒ ØµÙˆØª */
window.addEventListener('keydown', clickSound, {once:true});
</script>
</body>
</html>
