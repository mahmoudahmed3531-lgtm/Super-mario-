<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ูุนุจุฉ ุงูุฃุณุฆูุฉ โ Fly Express</title>
<link rel="manifest" href="manifest.json" />
<style>
  :root{
    --bg:#0b1724;
    --card:#0f1f30;
    --text:#e9f3ff;
    --muted:#96b2d6;
    --primary:#2ecc71;
    --warn:#ffd166;
    --danger:#ff5e6c;
    --brand:#2f9e44;
    --brand2:#4dabf7;
    --glass: rgba(255,255,255,.06);
    --ring: linear-gradient(90deg,#22d3ee,#a78bfa,#34d399);
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:
      radial-gradient(1000px 500px at 20% -10%, #10243c 0%, transparent 60%),
      radial-gradient(900px 480px at 100% 0%, #11283d 0%, transparent 60%),
      var(--bg);
    font-family: "Cairo", system-ui, -apple-system, Segoe UI, Roboto, Noto Naskh Arabic, sans-serif;
    color:var(--text);
    min-height:100dvh;
  }
  .container{
    max-width:980px;margin:28px auto;padding:16px;
  }
  .panel{
    background: linear-gradient(180deg,rgba(255,255,255,.06),rgba(0,0,0,.12));
    border:1px solid rgba(255,255,255,.08);
    box-shadow: 0 20px 60px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
    border-radius:24px; padding:24px 20px;
  }
  h1{margin:6px 0 2px; font-size:44px; text-align:center; letter-spacing:.5px}
  .sub{ text-align:center; color:var(--muted); font-weight:700; font-size:18px; }
  .stats{ display:flex; gap:14px; flex-wrap:wrap; justify-content:center; margin:16px 0 12px; }
  .pill{
    background: rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.08);
    border-radius:16px; padding:12px 18px; font-weight:800; color:#d9ecff;
    min-width:160px; text-align:center;
  }
  .lifelines{ display:flex; gap:12px; flex-wrap:wrap; justify-content:center; margin-bottom:10px; }
  .life-btn{
    border:0; border-radius:16px; padding:12px 16px; font-weight:800; color:#0e1a27; cursor:pointer;
    background: linear-gradient(135deg,#b3e5fc,#80deea);
    box-shadow:0 8px 24px rgba(0,0,0,.25);
  }
  .life-btn:disabled{ opacity:.45; filter:grayscale(.4); cursor:not-allowed; }
  .questionBox{
    margin:14px auto 18px; padding:18px;
    border-radius:18px; background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.08);
  }
  .meter{height:8px;border-radius:999px; background:rgba(255,255,255,.08); overflow:hidden; margin:2px 0 14px;}
  .meter>i{display:block;height:100%; background:var(--ring); width:0%;}
  .q{font-size:28px; text-align:center; font-weight:900; margin:10px 6px;}
  .answers{ display:grid; grid-template-columns:1fr; gap:12px; margin-top:10px; }
  @media(min-width:680px){ .answers{ grid-template-columns:1fr 1fr; } }
  .ans{
    border:0; border-radius:16px; padding:16px; font-size:18px; font-weight:800; color:#0b1522; cursor:pointer;
    background: linear-gradient(135deg,#a9d6ff,#b79cff);
    box-shadow:0 10px 30px rgba(0,0,0,.28);
    transition: transform .08s ease, box-shadow .2s ease, filter .2s ease;
  }
  .ans:hover{ transform: translateY(-1px); }
  .ans.correct{ background: linear-gradient(135deg,#9cffc7,#71e8b1); color:#052616;}
  .ans.wrong{ background: linear-gradient(135deg,#ffb3b3,#ff8c8c); color:#3a0a0a; }
  .hud{display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-top:10px;}
  .badge{ background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08); color:#eef6ff;
    border-radius:14px; padding:10px 14px; font-weight:800; min-width:150px; text-align:center;}
  .cta-wrap{ display:flex; justify-content:center; margin:16px 0 0; }
  .start{ border:0; border-radius:18px; padding:14px 22px; font-size:18px; font-weight:900; cursor:pointer;
    background: linear-gradient(135deg,#ffd166,#ff7e67); color:#181818; box-shadow:0 18px 40px rgba(0,0,0,.35);}
  .music-toggle{ position: fixed; left:16px; bottom:16px; z-index:9; padding:12px 16px; border-radius:14px; border:0;
    background: linear-gradient(135deg,#ffe082,#ffca28); color:#101; font-weight:900; box-shadow:0 8px 24px rgba(0,0,0,.25);}
  .toast{ position:fixed; inset:auto 0 18px 0; display:flex; justify-content:center; pointer-events:none; z-index:50;}
  .toast>div{background:rgba(26,41,58,.95);color:#e6f2ff;border:1px solid rgba(255,255,255,.1);padding:12px 16px;border-radius:14px;
    box-shadow:0 16px 40px rgba(0,0,0,.35); font-weight:800;}
  .rpgTitle{ font-size:22px; text-align:center; color:#9ad0ff; margin-top:8px; font-weight:900;}
  .note{ text-align:center; margin:8px 0; color:#bfe1ff; font-weight:800}
  .audience{ margin:6px 2px 0; display:none;}
  .audience.show{ display:block;}
  .audbar{height:8px;background:rgba(255,255,255,.1);border-radius:8px;overflow:hidden;margin:8px 0;}
  .audbar>i{display:block;height:100%;background:var(--ring)}
</style>
</head>
<body>

<div class="container">
  <div class="panel">
    <h1>โ ูุนุจุฉ ุงูุฃุณุฆูุฉ โ</h1>
    <div class="rpgTitle">Fly Express</div>
    <div class="sub" id="subline">ุงูุนุจ ูุงูุณุจ โ ูุฏูู 30 ุซุงููุฉ ููู ุณุคุงู โณ ุฅุฌุงุจุฉ ูุงุญุฏุฉ ููุท</div>

    <!-- ูุณุงุฆู ุงููุณุงุนุฏุฉ -->
    <div class="lifelines">
      <button id="life5050" class="life-btn">50:50</button>
      <button id="lifeAudience" class="life-btn">ุฑุฃู ุงูุฌูููุฑ</button>
      <button id="lifeSkip" class="life-btn">ุชุบููุฑ ุงูุณุคุงู</button>
      <button id="musicBtn" class="music-toggle">๐ต ููุณููู</button>
    </div>

    <!-- ุงูุฅุญุตุงุฆูุงุช -->
    <div class="stats">
      <div class="pill" id="timePill">ุงูููุช: 30 ุซ</div>
      <div class="pill" id="stepPill">ุงูุณุคุงู: 1/70</div>
      <div class="pill" id="prizePill">ุงูุฌูุงุฆุฒ: 30/50/70 โ ุงูุนุจ ูุงูุณุจ</div>
    </div>

    <!-- ุงูุตูุฏูู -->
    <div class="questionBox">
      <div class="meter"><i id="meter"></i></div>
      <div class="q" id="qText">ุงุถุบุท โุงุจุฏุฃ ุงููุนุจโ ูุจุฏุก ุงูุฌููุฉ</div>
      <div class="answers" id="answers"></div>

      <!-- ุฑุฃู ุงูุฌูููุฑ -->
      <div id="audiencePanel" class="audience">
        <div style="font-weight:900;color:#9ad0ff">ูุชูุฌุฉ ุฑุฃู ุงูุฌูููุฑ:</div>
        <div id="audA" class="audbar"><i style="width:0%"></i></div>
        <div id="audB" class="audbar"><i style="width:0%"></i></div>
        <div id="audC" class="audbar"><i style="width:0%"></i></div>
        <div id="audD" class="audbar"><i style="width:0%"></i></div>
      </div>
    </div>

    <!-- ุดุฑูุท ุชุญุช -->
    <div class="note" id="note">ุจุงูุชูููู ๐ธ โ ุงุถุบุท โุงุจุฏุฃ ุงููุนุจโ ููุจุฏุก!</div>

    <div class="cta-wrap">
      <button id="startBtn" class="start">๐ ุงุจุฏุฃ ุงููุนุจ</button>
    </div>
  </div>
</div>

<!-- ุฃุตูุงุช -->
<audio id="bgm" preload="auto" loop>
  <source src="assets/sounds/game-bgm.mp3" type="audio/mpeg" />
</audio>
<audio id="sfxRight" preload="auto">
  <source src="assets/sounds/correct.mp3" type="audio/mpeg" />
</audio>
<audio id="sfxClick" preload="auto">
  <source src="assets/sounds/click.mp3" type="audio/mpeg" />
</audio>
<audio id="sfxWrong" preload="auto">
  <source src="assets/sounds/wrong.mp3" type="audio/mpeg" />
</audio>

<div id="toast" class="toast" style="display:none"><div id="toastMsg"></div></div>

<script>
/* ===================== ุจูุงูุงุช ุงูุฃุณุฆูุฉ ===================== */
/* ูู ุนูุฏู ููู ุฎุงุฑุฌู (questions.js) ููู const QUESTIONS = [...]; ุงูููุฏ ููุณุชุฎุฏูู ุชููุงุฆููุง */
const QUESTIONS = (window.QUESTIONS && window.QUESTIONS.length)
? window.QUESTIONS
: [
  /* ุฃูุซูุฉ โ ุงุณุชุจุฏููุง ุจููู ุฃุณุฆูุชู ุงูู 70 */
  {q:"ูุง ุนุงุตูุฉ ูุตุฑุ", a:["ุงููุงูุฑุฉ","ุงูุฅุณููุฏุฑูุฉ","ุงูุฌูุฒุฉ","ุงูููุตูุฑุฉ"], c:0},
  {q:"ุฃุทูู ููุฑ ูู ุงูุนุงููุ", a:["ุงูุฃูุงุฒูู","ุงูููู","ุงููุงูุบุชุณู","ุงููููุบู"], c:1},
  {q:"ูู ุนุฏุฏ ูุงุฑุงุช ุงูุนุงููุ", a:["5","6","7","8"], c:2},
  {q:"ูู ุฃูู ูู ุฃุณูู ูู ุงูุตุจูุงูุ", a:["ุนูู ุจู ุฃุจู ุทุงูุจ","ุงูุญุณู","ุฒูุฏ ุจู ุซุงุจุช","ุนุจุฏุงููู ุจู ูุณุนูุฏ"], c:0},
  {q:"ูู ูุคูู ุตุญูุญ ุงูุจุฎุงุฑูุ", a:["ูุณูู","ุงูุจุฎุงุฑู","ุงูุชุฑูุฐู","ุงุจู ูุงุฌู"], c:1},
  {q:"ุนุงุตูุฉ ุงูุณุนูุฏูุฉุ", a:["ุฌุฏุฉ","ุงูุฑูุงุถ","ุงููุฏููุฉ","ููุฉ"], c:1},
  {q:"ุงูุบุงุฒ ุงูุฐู ูุชููุณูุ", a:["ุงูุฃูุณุฌูู","ุงููููู","ุงูููุฏุฑูุฌูู","ุงููููููู"], c:0},
  {q:"ูู ุฑูุนุฉ ูู ุตูุงุฉ ุงููุฌุฑุ", a:["4","3","2","1"], c:2},
  {q:"ุชูุน ูุฌุน ุญูุงุฏู ูู ูุญุงูุธุฉุ", a:["ุฃุณููุท","ููุง","ุณููุงุฌ","ุงูุฃูุตุฑ"], c:1},
  {q:"ุฃูุจุฑ ูุงุฑุฉุ", a:["ุฅูุฑูููุง","ุฃูุฑูุจุง","ุขุณูุง","ุฃูุฑููุง ุงูุดูุงููุฉ"], c:2},
];

/* ===================== ุนูุงุตุฑ ุงููุงุฌูุฉ ===================== */
const qText = document.getElementById('qText');
const answersWrap = document.getElementById('answers');
const meter = document.getElementById('meter');
const timePill = document.getElementById('timePill');
const stepPill = document.getElementById('stepPill');
const prizePill = document.getElementById('prizePill');
const startBtn = document.getElementById('startBtn');
const note = document.getElementById('note');

const btn5050 = document.getElementById('life5050');
const btnAudience = document.getElementById('lifeAudience');
const btnSkip = document.getElementById('lifeSkip');

const audiencePanel = document.getElementById('audiencePanel');
const audBars = {
  A: document.querySelector('#audA i'),
  B: document.querySelector('#audB i'),
  C: document.querySelector('#audC i'),
  D: document.querySelector('#audD i'),
};

const toast = document.getElementById('toast');
const toastMsg = document.getElementById('toastMsg');

const bgm = document.getElementById('bgm');
const sfxRight = document.getElementById('sfxRight');
const sfxClick = document.getElementById('sfxClick');
const sfxWrong = document.getElementById('sfxWrong');
const musicBtn = document.getElementById('musicBtn');

/* ===================== ุญุงูุฉ ุงููุนุจุฉ ===================== */
let idx = 0;              // ุฑูู ุงูุณุคุงู (0..)
let seconds = 30;         // ููุช ุงูุณุคุงู
let timer = null;
let used5050 = false;
let usedAudience = false;
let usedSkip = false;
let isPlaying = false;

/* ===================== ุฃุฏูุงุช ===================== */
function showToast(msg, ms=2000){
  toastMsg.textContent = msg;
  toast.style.display = 'flex';
  setTimeout(()=> toast.style.display='none', ms);
}
function safePlay(audio){ try { audio.currentTime=0; audio.play().catch(()=>{}); } catch(e){} }
function startBGM(){
  const p = bgm.play();
  if (p && p.catch) p.catch(()=>{
    const once=()=>{ bgm.play().catch(()=>{}); document.removeEventListener('click', once); };
    document.addEventListener('click', once, {once:true});
  });
}
musicBtn.addEventListener('click', ()=>{
  if (bgm.paused){ bgm.play().catch(()=>{}); musicBtn.textContent='โธ๏ธ ุฅููุงู ุงูููุณููู'; }
  else { bgm.pause(); musicBtn.textContent='๐ต ููุณููู'; }
});

/* ===================== ููุทู ุงูุฌูุงุฆุฒ ูุงููุงูุชุงุช ===================== */
function checkMilestones(){
  const step = idx+1;
  if (step===30){ showToast("๐ ูุจุฑูู! ูุณุจุช ุชูุตููู ูุฌุงูู"); note.textContent="ุงูุนุจ ูุงูุณุจ โ ูุตูุช ูููุณุชูู 30 โ"; }
  if (step===50){ showToast("๐๐ ูุจุฑูู! ูุณุจุช ุชูุตููุชูู ูุฌุงููุง"); note.textContent="ุงูุนุจ ูุงูุณุจ โ ูุตูุช ูููุณุชูู 50 โ"; }
  if (step===70){ showToast("๐ ูุจุฑูู! ูุณุจุช 3 ุชูุตููุงุช ูุฌุงููุง โ ููุงูุฉ ุงููุนุจุฉ", 3500); note.textContent="ุฅูุฌุงุฒ ุฑุงุฆุน! ูุตูุช ููุณุคุงู 70"; endGame(true); }
}

/* ===================== ุนุฑุถ ุณุคุงู ===================== */
function render(){
  const step = idx+1;
  stepPill.textContent = `ุงูุณุคุงู: ${step}/70`;
  timePill.textContent = `ุงูููุช: ${seconds} ุซ`;
  meter.style.width = `${(seconds/30)*100}%`;
  audiencePanel.classList.remove('show');

  const item = QUESTIONS[idx % QUESTIONS.length]; // ุญูุงูุฉ ูู ุฃูู ูู 70
  qText.textContent = `${step}. ${item.q}`;

  // ุฑุณู ุงูุฅุฌุงุจุงุช
  answersWrap.innerHTML = '';
  item.a.forEach((text, i)=>{
    const b = document.createElement('button');
    b.className='ans';
    b.textContent=text;
    b.addEventListener('click', ()=> choose(i,b));
    b.addEventListener('mousedown', ()=> safePlay(sfxClick));
    answersWrap.appendChild(b);
  });

  // ุชูุนูู/ุชุนุทูู ูุณุงุฆู ุงููุณุงุนุฏุฉ
  btn5050.disabled = used5050;
  btnAudience.disabled = usedAudience;
  btnSkip.disabled = usedSkip;
}

/* ===================== ุงููุคูุช ===================== */
function tick(){
  seconds--;
  if (seconds<0){ gameOver("ุงูุชูู ุงูููุช!"); return; }
  timePill.textContent = `ุงูููุช: ${seconds} ุซ`;
  meter.style.width = `${(seconds/30)*100}%`;
}

/* ===================== ุงุฎุชูุงุฑ ุฅุฌุงุจุฉ ===================== */
function choose(i, btn){
  if (!isPlaying) return;
  disableAll(true);
  const item = QUESTIONS[idx % QUESTIONS.length];
  if (i===item.c){
    btn.classList.add('correct');
    safePlay(sfxRight);
    setTimeout(()=>{
      idx++;
      checkMilestones();
      if (idx>=70){ return; } // endGame inside checkMilestones for step 70
      seconds=30; render();
      disableAll(false);
    }, 600);
  } else {
    btn.classList.add('wrong');
    safePlay(sfxWrong);
    setTimeout(()=> gameOver("ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ!"), 700);
  }
}
function disableAll(state){
  answersWrap.querySelectorAll('button.ans').forEach(b=> b.disabled=state);
}

/* ===================== ูุณุงุฆู ุงููุณุงุนุฏุฉ ===================== */
btn5050.addEventListener('click', ()=>{
  if (used5050) return;
  used5050=true; btn5050.disabled=true;
  const item = QUESTIONS[idx % QUESTIONS.length];
  const bads = [0,1,2,3].filter(x=>x!==item.c);
  // ุงุฎูุงุก ุฎูุงุฑูู ุนุดูุงุฆููู ุฎุงุทุฆูู
  shuffle(bads).slice(0,2).forEach(h=>{
    const b = answersWrap.children[h];
    if (b){ b.disabled=true; b.style.filter='grayscale(1) brightness(.7)'; b.style.opacity='.6'; }
  });
  showToast("ุชู ุญุฐู ุฅุฌุงุจุชูู");
});
btnAudience.addEventListener('click', ()=>{
  if (usedAudience) return;
  usedAudience=true; btnAudience.disabled=true;
  const item = QUESTIONS[idx % QUESTIONS.length];
  audiencePanel.classList.add('show');
  const dist = fakeAudience(item.c);
  audBars.A.style.width = dist[0]+"%";
  audBars.B.style.width = dist[1]+"%";
  audBars.C.style.width = dist[2]+"%";
  audBars.D.style.width = dist[3]+"%";
  showToast("ุฅุธูุงุฑ ุฑุฃู ุงูุฌูููุฑ");
});
btnSkip.addEventListener('click', ()=>{
  if (usedSkip) return;
  usedSkip=true; btnSkip.disabled=true;
  showToast("ุชู ุชุบููุฑ ุงูุณุคุงูุ ุจุงูุชูููู!");
  seconds=30; idx = Math.min(idx+1, 69); // ุงูุชูู ููุณุคุงู ุงูุชุงูู
  render();
});

function fakeAudience(correct){
  // ุชูุฒูุนุฉ ุจุณูุทุฉุ 45-70% ููุฅุฌุงุจุฉ ุงูุตุญูุญุฉ
  const good = Math.floor(45 + Math.random()*25);
  let other1 = Math.floor((100-good) * (0.5+Math.random()*0.3));
  let rest = 100-good-other1;
  let other2 = Math.floor(rest * (0.4+Math.random()*0.3));
  let other3 = 100-good-other1-other2;
  let arr = [other1,other2,other3];
  // ูุถุน good ูู correct index
  const res = [0,0,0,0];
  let p=0;
  for (let i=0;i<4;i++){
    res[i] = (i===correct)? good : arr[p++];
  }
  return res;
}
function shuffle(a){ return a.sort(()=>Math.random()-.5); }

/* ===================== ุงูุชุญูู ุงูุนุงู ===================== */
startBtn.addEventListener('click', startGame);
function startGame(){
  if (isPlaying) return;
  isPlaying=true; idx=0; seconds=30;
  used5050=usedAudience=usedSkip=false;
  startBtn.disabled=true;
  note.textContent = "ุงูุนุจ ูุงูุณุจ โ ุจุงูุชูููู!";
  render();
  clearInterval(timer);
  timer=setInterval(tick, 1000);
  startBGM();
}
function endGame(won=false){
  isPlaying=false; clearInterval(timer);
  disableAll(true);
  startBtn.disabled=false;
  if (won){
    showToast("๐ ุงูุชูุช ุงููุนุจุฉ โ ูุจุฑูู ุงูุฌูุงุฆุฒ!", 3000);
    note.textContent = "ููุชุงุฒ! ุชูุฏุฑ ุชุจุฏุฃ ูู ุฌุฏูุฏ ูุชูุณุฑ ุฑููู ๐";
  }
}
function gameOver(msg){
  isPlaying=false; clearInterval(timer);
  disableAll(true);
  showToast(msg, 1800);
  note.textContent = "ุงูุชูุช ุงูุฌููุฉ โ ุงุถุบุท 'ุงุจุฏุฃ ุงููุนุจ' ููุจุฏุก ูู ุฌุฏูุฏ";
  startBtn.disabled=false;
}

/* ุณูุงูุฉ ุงูุชุดุบูู ููููุณููู ุนูู ุงูููุงุชู */
window.addEventListener('DOMContentLoaded', ()=>{
  // ูุญุงููุฉ ุชุดุบูู ูุงุฏุฆุฉ
  startBGM();
});
</script>
</body>
</html>
