<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ูุนุจุฉ ุงูุฃุณุฆูุฉ โ Fly Express</title>
<style>
  :root{
    --bg:#0b1724;--card:#0f1f30;--text:#e9f3ff;--muted:#96b2d6;
    --ring:linear-gradient(90deg,#22d3ee,#a78bfa,#34d399);
  }
  *{box-sizing:border-box}
  body{
    margin:0;min-height:100dvh;color:var(--text);
    background: radial-gradient(900px 460px at 15% -10%,#10243c 0,transparent 60%),
               radial-gradient(900px 460px at 110% 0,#11283d 0,transparent 60%),var(--bg);
    font-family:"Cairo",system-ui,-apple-system,"Segoe UI",Roboto,"Noto Naskh Arabic",sans-serif
  }
  .container{max-width:980px;margin:28px auto;padding:16px}
  .panel{
    background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(0,0,0,.12));
    border:1px solid rgba(255,255,255,.08);
    border-radius:24px;padding:22px 18px;box-shadow:0 20px 60px rgba(0,0,0,.35)
  }
  h1{margin:6px 0 2px;font-size:44px;text-align:center}
  .rpgTitle{font-size:22px;text-align:center;color:#9ad0ff;font-weight:900}
  .winline{margin-top:8px;text-align:center;font-weight:900;color:#b9f6ca}
  .sub{ text-align:center;color:#bfe1ff;font-weight:800;margin-top:6px}
  .lifelines{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin:14px 0}
  .life-btn{border:0;border-radius:14px;padding:10px 14px;font-weight:900;color:#0d1522;
            background:linear-gradient(135deg,#b3e5fc,#80deea);box-shadow:0 8px 24px rgba(0,0,0,.25);cursor:pointer}
  .life-btn:disabled{opacity:.5;filter:grayscale(.5);cursor:not-allowed}
  .stats{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin:6px 0 10px}
  .pill{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);
        border-radius:14px;padding:10px 16px;font-weight:800;min-width:160px;text-align:center}
  .questionBox{margin:10px auto 16px;padding:18px;border-radius:18px;background:rgba(255,255,255,.05);
               border:1px solid rgba(255,255,255,.08)}
  .meter{height:8px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden;margin:4px 0 10px}
  .meter>i{display:block;height:100%;background:var(--ring);width:0%}
  .q{font-size:28px;text-align:center;font-weight:900;margin:10px 6px}
  .answers{display:grid;grid-template-columns:1fr;gap:12px;margin-top:10px}
  @media(min-width:680px){.answers{grid-template-columns:1fr 1fr}}
  .ans{border:0;border-radius:16px;padding:16px;font-size:18px;font-weight:800;color:#0b1522;cursor:pointer;
       background:linear-gradient(135deg,#a9d6ff,#b79cff);box-shadow:0 10px 30px rgba(0,0,0,.28);
       transition:transform .08s ease,filter .2s ease}
  .ans:hover{transform:translateY(-1px)}
  .ans.correct{background:linear-gradient(135deg,#9cffc7,#71e8b1);color:#052616}
  .ans.wrong{background:linear-gradient(135deg,#ffb3b3,#ff8c8c);color:#3a0a0a}
  .audience{display:none;margin-top:8px}
  .audience.show{display:block}
  .audbar{height:8px;background:rgba(255,255,255,.1);border-radius:8px;overflow:hidden;margin:6px 0}
  .audbar>i{display:block;height:100%;background:var(--ring);width:0%}
  .note{text-align:center;margin:8px 0;color:#bfe1ff;font-weight:800}
  .cta-wrap{display:flex;justify-content:center;margin-top:8px}
  .start{border:0;border-radius:18px;padding:14px 22px;font-size:18px;font-weight:900;cursor:pointer;
         background:linear-gradient(135deg,#ffd166,#ff7e67);color:#181818;box-shadow:0 18px 40px rgba(0,0,0,.35)}
  .toast{position:fixed;inset:auto 0 18px 0;display:none;justify-content:center;z-index:40}
  .toast>div{background:rgba(26,41,58,.95);color:#e6f2ff;border:1px solid rgba(255,255,255,.1);padding:12px 16px;border-radius:14px;
             box-shadow:0 16px 40px rgba(0,0,0,.35);font-weight:800}
</style>
</head>
<body>
<div class="container">
  <div class="panel">
    <h1>โ ูุนุจุฉ ุงูุฃุณุฆูุฉ โ</h1>
    <div class="rpgTitle">Fly Express</div>
    <div class="winline" id="winline">ุงูุนุจ ูุงูุณุจ โ ุฌูุงุฆุฒ ุนูุฏ 30 / 40 / 70</div>
    <div class="sub" id="subline">30 ุซุงููุฉ ููู ุณุคุงู โณ ุฅุฌุงุจุฉ ูุงุญุฏุฉ โ ุจุงูุชูููู ๐ธ</div>

    <div class="lifelines">
      <button id="life5050" class="life-btn">50:50</button>
      <button id="lifeAudience" class="life-btn">ุฑุฃู ุงูุฌูููุฑ</button>
      <button id="lifeSkip" class="life-btn">ุชุบููุฑ ุงูุณุคุงู</button>
    </div>

    <div class="stats">
      <div class="pill" id="timePill">ุงูููุช: 30 ุซ</div>
      <div class="pill" id="stepPill">ุงูุณุคุงู: 1/70</div>
      <div class="pill" id="prizePill">ุงูุฌูุงุฆุฒ: 30/40/70 โ ุงูุนุจ ูุงูุณุจ</div>
    </div>

    <div class="questionBox">
      <div class="meter"><i id="meter"></i></div>
      <div class="q" id="qText">ุงุถุบุท โุงุจุฏุฃ ุงููุนุจโ ูุจุฏุก ุงูุฌููุฉ</div>
      <div class="answers" id="answers"></div>

      <div id="audiencePanel" class="audience">
        <div style="font-weight:900;color:#9ad0ff">ูุชูุฌุฉ ุฑุฃู ุงูุฌูููุฑ:</div>
        <div id="audA" class="audbar"><i></i></div>
        <div id="audB" class="audbar"><i></i></div>
        <div id="audC" class="audbar"><i></i></div>
        <div id="audD" class="audbar"><i></i></div>
      </div>
    </div>

    <div class="note" id="note">ุจุงูุชูููู ๐ธ โ ุงุถุบุท โุงุจุฏุฃ ุงููุนุจโ</div>
    <div class="cta-wrap"><button id="startBtn" class="start">๐ ุงุจุฏุฃ ุงููุนุจ</button></div>
  </div>
</div>

<!-- (ุงุฎุชูุงุฑู) ููู ุตูุช ุฎุงุฑุฌู ูููู ุฅู ุญุจูุช ุชุถููู ุจููุณ ุงููุณุงุฑ -->
<audio id="sfxClickFile" preload="auto">
  <source src="assets/sounds/click.mp3" type="audio/mpeg">
</audio>

<div id="toast" class="toast"><div id="toastMsg"></div></div>

<script>
/* ============= ุฅุนุฏุงุฏ ูุงุชุณุงุจ ============= */
// ุนุฏูู ุงูุฑูู ุฃุฏูุงู ุฅูู ุฑูู ุงููุงุชุณุงุจ ุงูุฐู ูุตูู ุฅุดุนุงุฑ ุงูุฌูุงุฆุฒ (ุจุตูุบุฉ ุฏูููุฉ ุจุฏูู +)
const WHATSAPP_NUMBER = "201234567890"; // ูุซุงู: 2010xxxxxxx
function sendWhatsAppPrize(step){
  const msg = `ูุจุฑูู! ูุตูุช ูููุฑุญูุฉ ${step} ูู ูุนุจุฉ Fly Express ูุญุตูุช ุนูู ุฌุงุฆุฒุฉ ๐`;
  const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`;
  try { window.open(url, '_blank'); } catch(e) { location.href = url; }
}

/* ============= ุฃุณุฆูุฉ ุชุฌุฑูุจูุฉ ============= */
const QUESTIONS = (window.QUESTIONS && window.QUESTIONS.length) ? window.QUESTIONS : [
  {q:"ูุง ุนุงุตูุฉ ูุตุฑุ", a:["ุงููุงูุฑุฉ","ุงูุฅุณููุฏุฑูุฉ","ุงูุฌูุฒุฉ","ุงูููุตูุฑุฉ"], c:0},
  {q:"ุฃุทูู ููุฑ ูู ุงูุนุงููุ", a:["ุงูุฃูุงุฒูู","ุงูููู","ุงููุงูุบุชุณู","ุงููููุบู"], c:1},
  {q:"ูู ุนุฏุฏ ูุงุฑุงุช ุงูุนุงููุ", a:["5","6","7","8"], c:2},
  {q:"ูู ุฃูู ูู ุฃุณูู ูู ุงูุตุจูุงูุ", a:["ุนูู ุจู ุฃุจู ุทุงูุจ","ุงูุญุณู","ุฒูุฏ ุจู ุซุงุจุช","ุนุจุฏุงููู ุจู ูุณุนูุฏ"], c:0},
  {q:"ุนุงุตูุฉ ุงูุณุนูุฏูุฉุ", a:["ุฌุฏุฉ","ุงูุฑูุงุถ","ุงููุฏููุฉ","ููุฉ"], c:1},
  {q:"ุงูุบุงุฒ ุงููุงุฒู ููุชููุณุ", a:["ุงูุฃูุณุฌูู","ุงููููู","ุงูููุฏุฑูุฌูู","ุงููููููู"], c:0},
  {q:"ูู ุฑูุนุฉ ูู ุงููุฌุฑุ", a:["4","3","2","1"], c:2},
  {q:"ุชูุน ูุฌุน ุญูุงุฏู ูู ูุญุงูุธุฉุ", a:["ุฃุณููุท","ููุง","ุณููุงุฌ","ุงูุฃูุตุฑ"], c:1},
  {q:"ุฃูุจุฑ ูุงุฑุฉุ", a:["ุฅูุฑูููุง","ุฃูุฑูุจุง","ุขุณูุง","ุฃูุฑููุง ุงูุดูุงููุฉ"], c:2},
  {q:"ุฃูุจุฑ ูุญูุทุ", a:["ุงูุฃุทูุณู","ุงูููุฏู","ุงููุงุฏุฆ","ุงููุชุฌูุฏ"], c:2},
];

/* ============= ุนูุงุตุฑ DOM ============= */
const qText = document.getElementById('qText');
const answersWrap = document.getElementById('answers');
const meter = document.getElementById('meter');
const timePill = document.getElementById('timePill');
const stepPill = document.getElementById('stepPill');
const prizePill = document.getElementById('prizePill');
const startBtn = document.getElementById('startBtn');
const note = document.getElementById('note');
const subline = document.getElementById('subline');
const winline = document.getElementById('winline');

const btn5050 = document.getElementById('life5050');
const btnAudience = document.getElementById('lifeAudience');
const btnSkip = document.getElementById('lifeSkip');
const audiencePanel = document.getElementById('audiencePanel');
const audBars = {
  A: document.querySelector('#audA i'),
  B: document.querySelector('#audB i'),
  C: document.querySelector('#audC i'),
  D: document.querySelector('#audD i'),
};

const sfxClickFile = document.getElementById('sfxClickFile');

/* ============= ุตูุช ูููู ูุนูู ุจุฏูู ูููุงุช (WebAudio) ============= */
let audioCtx;
function playClick(){
  // ูู ูู ููู ุฎุงุฑุฌู ููุฌูุฏ ููุดุชุบูุ ูุฅูุง ููููุฏ ูููู ุจูู WebAudio
  const triedFile = sfxClickFile && sfxClickFile.src && sfxClickFile.src.length>0;
  if (triedFile){
    try{
      sfxClickFile.currentTime=0;
      sfxClickFile.play().catch(()=>{ synthClick(); });
      return;
    }catch(e){ /* ููููู ุจุงูู WebAudio */ }
  }
  synthClick();
}
function synthClick(){
  try{
    audioCtx = audioCtx || new (window.AudioContext||window.webkitAudioContext)();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type='square';
    o.frequency.value = 800;      // ูุบูุฉ ุนุงููุฉ ูุตูุฑุฉ
    g.gain.value = 0.12;          // ูุณุชูู ุงูุตูุช
    o.connect(g); g.connect(audioCtx.destination);
    o.start();
    // ุฅูฺคูููุจ: ุงูุฎูุงุถ ุณุฑูุน (ูููู)
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.06);
    o.stop(audioCtx.currentTime + 0.06);
  }catch(e){}
}

/* ============= ุญุงูุฉ ุงููุนุจุฉ ============= */
let idx=0, seconds=30, timer=null, isPlaying=false;
let used5050=false, usedAudience=false, usedSkip=false;

/* ============= ุฃุฏูุงุช ============= */
function showToast(msg,ms=2000){ 
  const toast=document.getElementById('toast'); const toastMsg=document.getElementById('toastMsg');
  toastMsg.textContent=msg; toast.style.display='flex'; 
  setTimeout(()=>toast.style.display='none',ms); 
}
function shuffle(a){ return a.sort(()=>Math.random()-.5); }

/* ============= Milestones ============= */
function checkMilestones(){
  const step = idx; // ุชู ุฒูุงุฏุชู ุจุนุฏ ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ
  if (step===30){ 
    showToast("๐ ูุจุฑูู! ูุณุจุช ุชูุตููู ูุฌุงูู"); 
    winline.textContent="ุงูุนุจ ูุงูุณุจ โ ูุตูุช ูููุฑุญูุฉ 30 โ";
    sendWhatsAppPrize(30); 
  }
  if (step===40){ 
    showToast("๐๐ ูุจุฑูู! ููุงูุฃุฉ ุนูุฏ ุงููุฑุญูุฉ 40"); 
    winline.textContent="ุงูุนุจ ูุงูุณุจ โ ูุตูุช ูููุฑุญูุฉ 40 โ";
    sendWhatsAppPrize(40); 
  }
  if (step===70){ 
    showToast("๐ ูุจุฑูู! 3 ุชูุตููุงุช ูุฌุงููุฉ โ ููุงูุฉ ุงููุนุจุฉ",3500); 
    winline.textContent="ุงูุนุจ ูุงูุณุจ โ ุฃูููุช ุงููุนุจุฉ ููุตูุช ููุณุคุงู 70 ๐";
    sendWhatsAppPrize(70); 
    endGame(true); 
  }
}

/* ============= ุนุฑุถ ุณุคุงู ============= */
function render(){
  const step = idx+1;
  stepPill.textContent = `ุงูุณุคุงู: ${step}/70`;
  timePill.textContent = `ุงูููุช: ${seconds} ุซ`;
  prizePill.textContent = "ุงูุฌูุงุฆุฒ: 30/40/70 โ ุงูุนุจ ูุงูุณุจ";
  meter.style.width = `${(seconds/30)*100}%`;
  audiencePanel.classList.remove('show');

  const item = QUESTIONS[idx % QUESTIONS.length];
  qText.textContent = `${step}. ${item.q}`;

  answersWrap.innerHTML="";
  item.a.forEach((text, i)=>{
    const b=document.createElement('button');
    b.className='ans'; b.textContent=text;
    b.addEventListener('click', ()=> choose(i,b));
    b.addEventListener('mousedown', playClick);
    answersWrap.appendChild(b);
  });

  btn5050.disabled = used5050;
  btnAudience.disabled = usedAudience;
  btnSkip.disabled = usedSkip;
}

/* ============= ูุคูุช ============= */
function tick(){
  seconds--;
  if (seconds<0){ gameOver("ุงูุชูู ุงูููุช! ุชู ุงูุฑุฌูุน ููุจุฏุงูุฉ"); return; }
  timePill.textContent = `ุงูููุช: ${seconds} ุซ`;
  meter.style.width = `${(seconds/30)*100}%`;
}

/* ============= ุงุฎุชูุงุฑ ุฅุฌุงุจุฉ ============= */
function choose(i,btn){
  if(!isPlaying) return;
  disableAll(true);
  const item = QUESTIONS[idx % QUESTIONS.length];
  const correct = i===item.c;
  btn.classList.add(correct?'correct':'wrong');
  playClick();

  setTimeout(()=>{
    if (correct){
      idx++;
      if (idx>=70){ checkMilestones(); return; }
      seconds=30; render(); disableAll(false);
      checkMilestones();
    } else {
      gameOver("ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ! ุชู ุงูุฑุฌูุน ููุจุฏุงูุฉ");
    }
  }, 520);
}
function disableAll(state){
  answersWrap.querySelectorAll('button.ans').forEach(b=> b.disabled=state);
}

/* ============= ูุณุงุฆู ุงููุณุงุนุฏุฉ ============= */
document.getElementById('life5050').addEventListener('click', ()=>{
  if (used5050) return; used5050=true; playClick(); document.getElementById('life5050').disabled=true;
  const item = QUESTIONS[idx % QUESTIONS.length];
  const bads = [0,1,2,3].filter(x=>x!==item.c);
  shuffle(bads).slice(0,2).forEach(h=>{
    const b = answersWrap.children[h];
    if (b){ b.disabled=true; b.style.filter='grayscale(1) brightness(.68)'; b.style.opacity='.65'; }
  });
  showToast("ุชู ุญุฐู ุฅุฌุงุจุชูู");
});
document.getElementById('lifeAudience').addEventListener('click', ()=>{
  if (usedAudience) return; usedAudience=true; playClick(); document.getElementById('lifeAudience').disabled=true;
  const item = QUESTIONS[idx % QUESTIONS.length];
  const dist = fakeAudience(item.c);
  audiencePanel.classList.add('show');
  document.querySelector('#audA i').style.width=dist[0]+"%";
  document.querySelector('#audB i').style.width=dist[1]+"%";
  document.querySelector('#audC i').style.width=dist[2]+"%";
  document.querySelector('#audD i').style.width=dist[3]+"%";
  showToast("ุฑุฃู ุงูุฌูููุฑ ุธูุฑ");
});
document.getElementById('lifeSkip').addEventListener('click', ()=>{
  if (usedSkip) return; usedSkip=true; playClick(); document.getElementById('lifeSkip').disabled=true;
  showToast("ุชู ุชุบููุฑ ุงูุณุคุงู");
  idx = Math.min(idx+1,69);
  seconds=30; render();
});
function fakeAudience(correct){
  const good = Math.floor(45+Math.random()*25);
  const rest = 100-good;
  const a = Math.floor(rest*(0.4+Math.random()*0.3));
  const b = Math.floor((rest-a)*(0.45+Math.random()*0.25));
  const c = 100-good-a-b;
  const out=[a,b,c,0];
  out.splice(correct,0,good);
  out.length=4;
  return out;
}

/* ============= ุชุญูู ุนุงู ============= */
document.getElementById('startBtn').addEventListener('click', startGame);

function resetStateToStart(){
  idx=0; seconds=30;
  used5050=usedAudience=usedSkip=false;
  audiencePanel.classList.remove('show');
  qText.textContent = "ุงุถุบุท โุงุจุฏุฃ ุงููุนุจโ ูุจุฏุก ุงูุฌููุฉ";
  answersWrap.innerHTML = "";
  meter.style.width = "100%";
  stepPill.textContent = "ุงูุณุคุงู: 1/70";
  timePill.textContent = "ุงูููุช: 30 ุซ";
  subline.textContent = "30 ุซุงููุฉ ููู ุณุคุงู โณ ุฅุฌุงุจุฉ ูุงุญุฏุฉ โ ุจุงูุชูููู ๐ธ";
  winline.textContent = "ุงูุนุจ ูุงูุณุจ โ ุฌูุงุฆุฒ ุนูุฏ 30 / 40 / 70";
}

function startGame(){
  isPlaying=true;
  clearInterval(timer);
  seconds=30;
  used5050=usedAudience=usedSkip=false;
  document.getElementById('startBtn').disabled=true;
  note.textContent="ุจุงูุชูููู! ุงูุนุจ ูุงูุณุจ";
  render();
  timer=setInterval(tick,1000);
}

function endGame(won=false){
  isPlaying=false;
  clearInterval(timer);
  disableAll(true);
  document.getElementById('startBtn').disabled=false;
  if (won){
    showToast("๐ ุงูุชูุช ุงููุนุจุฉ โ ูุจุฑูู ุงูุฌูุงุฆุฒ!", 3000);
    note.textContent="ุงูุชูุช ุงูุฌููุฉ โ ุงุถุบุท 'ุงุจุฏุฃ ุงููุนุจ' ููุจุฏุก ูู ุฌุฏูุฏ";
  }
  resetStateToStart();
}

function gameOver(msg){
  isPlaying=false;
  clearInterval(timer);
  disableAll(true);
  showToast(msg,2000);
  note.textContent="ุงูุชูุช ุงูุฌููุฉ โ ุงุถุบุท 'ุงุจุฏุฃ ุงููุนุจ' ููุจุฏุก ูู ุฌุฏูุฏ";
  document.getElementById('startBtn').disabled=false;
  resetStateToStart();   // ูุฑุฌุน ููุฑูุง ููุจุฏุงูุฉ
}
</script>
</body>
</html>
